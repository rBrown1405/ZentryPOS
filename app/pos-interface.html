<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Macros POS LOL - Point of Sale</title>
    <style>        /* Complete CSS Reset for Full Viewport */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            max-width: 100vw;
            overflow-x: hidden;
            overflow-y: hidden;
            font-family: 'Courier New', monospace;
        }
          /* POS Interface Container - Full Viewport */
        .pos-container {
            border: 3px solid #000;
            height: 100vh;
            width: 100vw;
            max-width: 100vw;
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            background: #ffffff;
            overflow: hidden;
        }        /* Header Styles */        .pos-header {
            background: #2d3748;
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid #000;
            flex-shrink: 0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            width: 100vw;
            height: 80px;
            box-sizing: border-box;
            z-index: 1000; /* Ensure header stays on top */
        }

        .header-left {
            display: flex;
            flex-direction: column;
        }

        .system-name {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .account-info {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .hotel-name {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-top: 0.1rem;
        }

        .header-tabs {
            display: flex;
            gap: 0.5rem;
        }        .tab-button {
            background: #4a5568;
            border: 2px solid #000;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .tab-button:hover {
            background: #2d3748;
        }

        .tab-button.active {
            background: #1a202c;
            border-color: #fff;
        }

        .header-actions {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }        .header-btn {
            background: #4a5568;
            border: 2px solid #000;
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
        }        .header-btn:hover {
            background: #2d3748;
        }

        /* Property Switcher Styles - Integrated with Header */
        .property-switcher {
            margin-top: 0.5rem;
            padding: 0.25rem 0;
        }

        .property-select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-family: 'Courier New', monospace;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(8px);
            min-width: 200px;
        }

        .property-select:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .property-select:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.7);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.2);
        }

        /* Style for property select options */
        .property-select option {
            background: #2d3748;
            color: white;
            padding: 0.5rem;
        }

        .property-select option:hover {
            background: #4a5568;
        }

        /* Current property indicator */
        .property-select option[selected] {
            background: #4a5568;
            font-weight: bold;
        }/* Main Content Layout - Full Remaining Space */
        .pos-main {
            display: flex;
            flex: 1;
            overflow: hidden;
            min-height: 0;
            width: 100%;
            max-width: 100%;
        }        /* Left Panel - Menu Grid */
        .menu-panel {
            flex: 2;
            padding: 1.5rem;
            overflow-y: auto;
            background: #ffffff;
            border-right: 3px solid #000;
            position: relative;
            margin-top: 80px; /* Account for fixed header */
        }

        .menu-panel::before {
            content: "Menu Section";
            position: absolute;
            top: 0.5rem;
            left: 50%;
            transform: translateX(-50%);
            font-weight: bold;
            font-size: 1.1rem;
            color: #2d3748;
        }        /* Kitchen Panel */
        .kitchen-panel {
            flex: 2;
            padding: 1.5rem;
            overflow-y: auto;
            background: #ffffff;
            border-right: 3px solid #000;
            position: relative;
            margin-top: 80px; /* Account for fixed header */
        }

        .kitchen-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1rem;
            background: #f8fafc;
            border: 2px solid #000;
            border-radius: 8px;
        }

        .kitchen-header h2 {
            font-size: 1.3rem;
            color: #2d3748;
            margin: 0;
        }

        .kitchen-orders {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .kitchen-order {
            background: white;
            border: 3px solid #000;
            border-radius: 8px;
            padding: 1.5rem;
            position: relative;
        }

        .kitchen-order.preparing {
            border-color: #f59e0b;
            background: #fef3c7;
        }

        .kitchen-order.ready {
            border-color: #059669;
            background: #f0fdf4;
        }

        .kitchen-order.served {
            border-color: #6b7280;
            background: #f9fafb;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .order-number {
            font-weight: bold;
            font-size: 1.1rem;
            color: #1f2937;
        }

        .order-status {
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .order-status.preparing {
            background: #f59e0b;
            color: white;
        }

        .order-status.ready {
            background: #059669;
            color: white;
        }

        .order-status.served {
            background: #6b7280;
            color: white;
        }

        .order-items-list {
            margin-bottom: 1rem;
        }

        .kitchen-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .kitchen-item:last-child {
            border-bottom: none;
        }

        .item-name-qty {
            font-weight: 500;
        }

        .order-time {
            font-size: 0.8rem;
            color: #6b7280;
            text-align: center;
        }

        .status-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .status-btn {
            flex: 1;
            padding: 0.5rem;
            border: 2px solid #000;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .status-btn.prepare {
            background: #f59e0b;
            color: white;
        }

        .status-btn.ready {
            background: #059669;
            color: white;
        }

        .status-btn.served {
            background: #6b7280;
            color: white;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 2rem;
        }

        .menu-item {
            background: white;
            border: 3px solid #000;
            border-radius: 4px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            height: 160px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .menu-item:hover {
            background: #f7fafc;
            transform: translateY(-2px);
        }

        .item-image {
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .item-name {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: #1a202c;
            text-align: center;
        }

        .item-price {
            font-size: 1.1rem;
            font-weight: bold;
            color: #059669;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .item-actions {
            display: flex;
            gap: 0.25rem;
            margin-top: auto;
        }

        .item-btn {
            flex: 1;
            padding: 0.4rem;
            border: 1px solid #000;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .customize-btn {
            background: #f7fafc;
            color: #4a5568;
            border: 1px solid #e2e8f0;
        }

        .customize-btn:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
        }

        .details-btn {
            background: #667eea;
            color: white;
        }

        .details-btn:hover {
            background: #5a67d8;
        }        /* Right Panel - Order Cart */
        .order-panel {
            flex: 1;
            min-width: 350px;
            background: white;
            display: flex;
            flex-direction: column;
            position: relative;
            margin-top: 80px; /* Account for fixed header */
        }

        .order-header {
            background: #f8fafc;
            padding: 1rem 1.5rem;
            border-bottom: 3px solid #000;
            position: relative;
            flex-shrink: 0;
        }        .order-header::before {
            content: "Order Cart";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            font-size: 1.1rem;
            color: #2d3748;
            border: 2px solid #000;
            background: white;
            padding: 0.5rem 1rem;
        }        /* Table Indicator */
        .table-indicator {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: #10b981;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            border: 2px solid #000;
            display: none;
            align-items: center;
            gap: 0.5rem;
        }

        .table-indicator.active {
            display: flex;
        }

        .table-indicator.available {
            background: #10b981;
            border-color: #059669;
        }

        .table-indicator.occupied {
            background: #dc2626;
            border-color: #b91c1c;
        }

        .table-indicator.reserved {
            background: #f59e0b;
            border-color: #d97706;
        }        .table-close-btn {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.6);
            color: white;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.2s;
            margin-left: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .table-close-btn:hover {
            background: rgba(0, 0, 0, 0.7);
            border-color: white;
            transform: scale(1.15);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);        }        /* Tables Panel - Visual Floor Plan */
        .tables-panel {
            flex: 2;
            padding: 1.5rem;
            overflow: auto;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-right: 3px solid #000;
            position: relative;
            margin-top: 80px; /* Account for fixed header */
        }.floor-plan-canvas {
            position: relative;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 2px solid #000;
            border-radius: 16px;
            min-height: 800px;
            margin-top: 2rem;
            overflow: hidden;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 8px 32px rgba(0, 0, 0, 0.1),
                0 4px 16px rgba(0, 0, 0, 0.05);
        }

        .floor-plan-table {
            position: absolute;
            border: 2px solid #000;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            font-weight: 600;
            user-select: none;
            border-radius: 12px;
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.1),
                0 2px 4px rgba(0, 0, 0, 0.06),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(8px);
            overflow: hidden;
        }

        .floor-plan-table::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 30%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.4) 0%, transparent 100%);
            pointer-events: none;
        }

        .floor-plan-table:hover {
            transform: translateY(-3px) scale(1.02);
            z-index: 10;
            box-shadow: 
                0 12px 32px rgba(0, 0, 0, 0.15),
                0 4px 12px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
        }

        .floor-plan-table.available {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-color: #22c55e;
            color: #15803d;
        }

        .floor-plan-table.available:hover {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-color: #16a34a;
        }

        .floor-plan-table.occupied {
            background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
            border-color: #ef4444;
            color: #dc2626;
        }

        .floor-plan-table.occupied:hover {
            background: linear-gradient(135deg, #fef7f7 0%, #fee2e2 100%);
            border-color: #dc2626;
        }

        .floor-plan-table.reserved {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-color: #f59e0b;
            color: #d97706;
        }

        .floor-plan-table.reserved:hover {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border-color: #d97706;
        }

        .floor-plan-table.selected {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-color: #3b82f6;
            color: #1e40af;
            box-shadow: 
                0 0 0 3px rgba(59, 130, 246, 0.3),
                0 12px 32px rgba(59, 130, 246, 0.2),
                0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .floor-plan-table .table-name-display {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 4px;
            color: inherit;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
            letter-spacing: 0.025em;
        }

        .floor-plan-table .table-capacity-display {
            font-size: 11px;
            color: inherit;
            opacity: 0.8;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.3);
            padding: 2px 6px;
            border-radius: 8px;
            backdrop-filter: blur(4px);
        }

        .floor-plan-table.circle {
            border-radius: 50%;
        }

        .floor-plan-table.curved {
            border-radius: 40px;
        }

        .floor-plan-table.booth {
            border-radius: 8px;
        }

        .floor-plan-table.bar-seat {
            border-radius: 4px;
        }

        .tables-grid {
            display: none; /* Hide the old grid view */
        }

        .table-item {
            background: white;
            border: 3px solid #000;
            border-radius: 8px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            height: 180px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .table-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .table-item.occupied {
            background: #fef2f2;
            border-color: #dc2626;
        }

        .table-item.reserved {
            background: #fef3c7;
            border-color: #f59e0b;
        }

        .table-item.available {
            background: #f0fdf4;
            border-color: #059669;
        }

        .table-item.selected {
            background: #dbeafe;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }

        .table-capacity {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .table-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #1a202c;
        }

        .table-status {
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .table-item.occupied .table-status {
            color: #dc2626;
        }

        .table-item.reserved .table-status {
            color: #f59e0b;
        }

        .table-item.available .table-status {
            color: #059669;
        }        .table-info {
            font-size: 0.7rem;
            color: #6b7280;
            text-align: center;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }        /* Room Service Styles - Only apply when Room Service view is active */
        #roomServiceView.room-service-panel {
            padding: 0 !important;
            overflow-y: auto !important;
            background: #f8fafc !important;
            height: calc(100vh - 80px) !important; /* Account for header height */
            width: 100vw !important;
            max-width: 100vw !important;
            display: none !important; /* Hidden by default */
            flex-direction: column !important;
            position: fixed !important; /* Changed to fixed for better positioning */
            top: 80px !important; /* Position below header */
            left: 0 !important;
            right: 0 !important; /* Ensure full width */
            margin: 0 !important;
            border: none !important;
            z-index: 500 !important; /* Well below header to prevent overlap */
        }
        
        /* Show Room Service when active */
        #roomServiceView.room-service-panel[style*="display: block"] {
            display: flex !important; /* Override hidden state when shown */
        }        #roomServiceView .room-service-header {
            background: linear-gradient(135deg, #4f46e5, #7c3aed) !important;
            color: white !important;
            padding: 1.5rem !important;
            border-radius: 0 !important;
            margin: 0 !important;
            border: none !important;
            border-bottom: 3px solid #000 !important;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
            flex-shrink: 0;
            width: 100% !important;
            box-sizing: border-box !important;
        }        #roomServiceView .room-service-content {
            display: grid !important;
            grid-template-columns: 18% 1fr 22% !important;
            gap: 0 !important;
            height: calc(100vh - 140px) !important;
            flex: 1 !important;
            min-height: 0 !important;
            width: 100% !important;
            max-width: 100% !important;
            position: relative !important;
            margin: 0 !important;
            padding: 0 !important;
            border: none !important;
            box-sizing: border-box !important;
        }/* Guest Info Column - Only for Room Service view */
        #roomServiceView .guest-info-column {
            display: flex !important;
            flex-direction: column !important;
            gap: 1rem !important;
            padding: 1rem !important;
            background: #f8fafc !important;
            border-right: 1px solid #e5e7eb !important;
            width: 100% !important;
            max-width: 100% !important;
        }

        #roomServiceView .guest-info-column > div {
            background: white !important;
            border: 2px solid #000 !important;
            border-radius: 8px !important;
            padding: 1rem !important;
            transition: all 0.3s ease;
        }

        #roomServiceView .guest-info-column > div:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }        .guest-info-column input,
        .guest-info-column select {
            width: 100% !important;
            padding: 0.75rem !important;
            border: 2px solid #e5e7eb !important;
            border-radius: 6px !important;
            font-family: inherit !important;
            transition: border-color 0.2s ease;
        }

        .guest-info-column input:focus,
        .guest-info-column select:focus {
            outline: none !important;
            border-color: #4f46e5 !important;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1) !important;
        }

        .guest-info-column label {
            display: block !important;
            font-weight: 600 !important;
            margin-bottom: 0.5rem !important;
            color: #374151 !important;
        }        /* Menu Column */
        #roomServiceView .menu-column {
            background: white !important;
            border: none !important;
            border-left: 2px solid #000 !important;
            border-right: 2px solid #000 !important;
            border-radius: 0 !important;
            overflow: hidden !important;
            display: flex !important;
            flex-direction: column !important;
            transition: all 0.3s ease;
            padding: 1rem !important;
            width: 100% !important;
            max-width: 100% !important;
        }        #roomServiceView .menu-column:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }        #roomServiceView .menu-column > div:first-child {
            background: #f8fafc !important;
            padding: 1rem !important;
            border-bottom: 2px solid #e5e7eb !important;
            font-weight: bold !important;
            color: #374151 !important;
            display: flex !important;
            align-items: center !important;
            gap: 0.5rem !important;
            flex-shrink: 0 !important;
        }

        #menuSearch {
            width: 100% !important;
            padding: 0.75rem !important;
            border: 2px solid #e5e7eb !important;
            border-radius: 6px !important;
            font-family: inherit !important;
            transition: border-color 0.2s ease;
        }

        #menuSearch:focus {
            outline: none !important;
            border-color: #4f46e5 !important;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1) !important;
        }        #roomServiceMenuGrid {
            display: grid !important;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)) !important;
            gap: 0.75rem !important;
            padding: 1rem !important;
            overflow-y: auto !important;
            flex: 1 !important;
        }        #roomServiceMenuGrid .menu-item {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            min-height: 120px;
        }

        #roomServiceMenuGrid .menu-item:hover {
            border-color: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 70, 229, 0.2);
        }

        #roomServiceMenuGrid .menu-item h4 {
            margin: 0 0 0.5rem 0;
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
        }

        #roomServiceMenuGrid .menu-item .description {
            color: #6b7280;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            flex: 1;
            line-height: 1.4;
        }

        #roomServiceMenuGrid .menu-item .price {
            color: #059669;
            font-weight: bold;
            font-size: 1.1rem;
            margin: 0;
        }

        #roomServiceMenuGrid .menu-item .room-service-only {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: #4f46e5;
            color: white;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-weight: 500;
        }        /* Cart Column */
        #roomServiceView .cart-column {
            background: white !important;
            border: none !important;
            border-left: 2px solid #000 !important;
            border-radius: 0 !important;
            display: flex !important;
            flex-direction: column !important;
            transition: all 0.3s ease;
            padding: 1rem !important;
            width: 100% !important;
            max-width: 100% !important;
        }        #roomServiceView .cart-column:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }        #roomServiceView .cart-column > div:first-child {
            background: #f8fafc !important;
            padding: 1rem !important;
            border-bottom: 2px solid #e5e7eb !important;
            font-weight: bold !important;
            color: #374151 !important;
            display: flex !important;
            align-items: center !important;
            gap: 0.5rem !important;
            flex-shrink: 0 !important;
        }

        #roomServiceCartItems {
            flex: 1 !important;
            padding: 1rem !important;
            overflow-y: auto !important;
            min-height: 200px !important;
        }        #roomServiceView .room-service-cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #e5e7eb;
        }

        #roomServiceView .room-service-cart-item:last-child {
            border-bottom: none;
        }

        #roomServiceView .room-service-cart-item .item-info {
            flex: 1;
        }

        #roomServiceView .room-service-cart-item .item-name {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }

        #roomServiceView .room-service-cart-item .item-price {
            color: #6b7280;
            font-size: 0.875rem;
        }

        #roomServiceView .room-service-cart-item .quantity-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        #roomServiceView .room-service-cart-item .quantity-controls button {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        #roomServiceView .room-service-cart-item .quantity-controls button:hover {
            background: #e5e7eb;
        }

        #roomServiceView .room-service-cart-item .quantity-controls span {
            min-width: 20px;
            text-align: center;
            font-weight: 600;
        }

        #roomServiceCartTotal {
            border-top: 2px solid #e5e7eb !important;
            padding: 1rem !important;
            flex-shrink: 0 !important;
        }

        #roomServiceCartTotal > div {
            display: flex !important;
            justify-content: space-between !important;
            margin-bottom: 0.5rem !important;
        }

        #roomServiceCartTotal > div:last-child {
            font-weight: bold !important;
            font-size: 1.1rem !important;
            border-top: 2px solid #374151 !important;
            padding-top: 0.5rem !important;
            margin-bottom: 1rem !important;
        }

        #specialInstructions {
            width: 100% !important;
            padding: 0.5rem !important;
            border: 2px solid #e5e7eb !important;
            border-radius: 4px !important;
            font-family: inherit !important;
            height: 60px !important;
            font-size: 0.9rem !important;
            resize: none !important;
            transition: border-color 0.2s ease;
        }

        #specialInstructions:focus {
            outline: none !important;
            border-color: #4f46e5 !important;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1) !important;
        }

        #roomServiceCheckoutBtn {
            width: 100% !important;
            background: linear-gradient(135deg, #4f46e5, #7c3aed) !important;
            color: white !important;
            border: none !important;
            padding: 1rem !important;
            border-radius: 6px !important;
            font-weight: 600 !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            font-size: 1rem !important;
        }

        #roomServiceCheckoutBtn:hover:not(:disabled) {
            background: linear-gradient(135deg, #4338ca, #6d28d9) !important;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3);
        }

        #roomServiceCheckoutBtn:disabled {
            background: #9ca3af !important;
            cursor: not-allowed !important;
            transform: none !important;
            box-shadow: none !important;
        }        /* Print Order Button */
        .print-order-btn {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 0.75rem;
            width: 100%;
        }

        .print-order-btn:hover {
            background: linear-gradient(135deg, #0284c7, #0369a1);
            transform: translateY(-2px);
        }

        .print-order-btn:disabled {
            background: linear-gradient(135deg, #9ca3af, #6b7280);
            cursor: not-allowed;
            transform: none;
        }

        /* Print Modal Styles */        .print-modal {
            background-color: white;
            border-radius: 12px;
            width: 80%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
            position: relative;
        }

        .print-modal-content {
            background-color: white;
            border-radius: 8px;
            width: 80%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 2rem;
            font-size: 1.2rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .print-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .print-modal-title {
            font-size: 1.8rem;
            font-weight: bold;
            color: #111827;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .print-modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #4b5563;
        }

        .print-modal-body {
            font-family: 'Courier New', monospace;
        }

        .print-guest-info {
            margin-bottom: 2rem;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .print-guest-info h3 {
            margin-top: 0;
            margin-bottom: 1rem;
            color: #374151;
        }

        .print-guest-detail {
            margin-bottom: 0.75rem;
            font-size: 1.4rem;
            display: flex;
        }

        .print-guest-detail strong {
            width: 180px;
            display: inline-block;
        }

        .print-items {
            margin-bottom: 2rem;
        }

        .print-items h3 {
            margin-top: 0;
            margin-bottom: 1rem;
            color: #374151;
        }

        .print-item {
            padding: 0.75rem 0;
            border-bottom: 1px solid #e5e7eb;
            font-size: 1.4rem;
            display: flex;
            justify-content: space-between;
        }

        .print-item-name {
            font-weight: 600;
        }

        .print-item-qty {
            margin-right: 1rem;
            color: #4b5563;
        }

        .print-modal-footer {
            margin-top: 2rem;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .print-btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
        }

        .print-btn:hover {
            background: #1d4ed8;
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .print-modal-content * {
                visibility: visible;
            }
            .print-modal-footer, .print-modal-close, .modal-close {
                display: none;
            }
            .print-modal-content {
                width: 100%;
                position: absolute;
                left: 0;
                top: 0;
                box-shadow: none;
                padding: 1.5cm;
                font-size: 16pt;
            }
            .print-modal {
                background-color: white;
                height: auto;
                overflow: visible;
            }
        }

        /* Responsive Design for Room Service */
        @media (max-width: 1600px) {
            #roomServiceView .room-service-content {
                grid-template-columns: 22% 1fr 28% !important;
            }
        }

        @media (max-width: 1400px) {
            #roomServiceView .room-service-content {
                grid-template-columns: 24% 1fr 30% !important;
            }
        }@media (max-width: 1200px) {
            #roomServiceView .room-service-content {
                grid-template-columns: 1fr !important;
                grid-template-rows: auto auto auto !important;
                height: auto !important;
                gap: 1rem !important;
            }
            
            #roomServiceView .guest-info-column,
            #roomServiceView .menu-column,
            #roomServiceView .cart-column {
                border: 2px solid #000 !important;
                border-radius: 8px !important;
                margin: 0.5rem !important;
            }
            
            #roomServiceView .guest-info-column {
                flex-direction: row !important;
                gap: 1rem !important;
            }
            
            #roomServiceView .guest-info-column > div:first-child {
                flex: 2 !important;
            }
            
            #roomServiceView .guest-info-column > div:last-child {
                flex: 1 !important;
                min-height: 200px !important;
            }
            
            #roomServiceView .menu-column,
            #roomServiceView .cart-column {
                max-height: 600px !important;
            }
              #roomServiceMenuGrid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)) !important;
            }
        }        @media (max-width: 768px) {
            #roomServiceView .room-service-content {
                gap: 0.75rem !important;
            }
            
            #roomServiceView .guest-info-column {
                flex-direction: column !important;
            }
            
            #roomServiceView .guest-info-column > div {
                padding: 1rem !important;
            }
            
            #roomServiceView .room-service-header {
                padding: 1rem !important;
                margin-bottom: 1rem !important;
            }
            
            #roomServiceMenuGrid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)) !important;
                gap: 0.75rem !important;
            }
            
            #roomServiceMenuGrid .menu-item {
                min-height: 120px !important;
                padding: 0.75rem !important;
            }
        }

        /* Order Summary Panel Styles */
        #roomServiceOrderSummary {
            font-family: monospace !important;
            background: #f8fafc !important;
            padding: 1rem !important;
            border-radius: 6px !important;
            border: 1px solid #e5e7eb !important;
            flex: 1 !important;
            font-size: 0.875rem;
            white-space: pre-line;
        }

        /* Enhanced menu item icons */
        .menu-item-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        /* Sync status indicators */
        .sync-status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
            color: #6b7280;
        }

        .sync-status-indicator.synced {
            color: #059669;
        }

        .sync-status-indicator.custom {
            color: #f59e0b;
        }        /* Loading states */
        #roomServiceView .room-service-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            color: #6b7280;
        }

        #roomServiceView .room-service-loading::before {
            content: "🛎️";
            font-size: 2rem;
            margin-right: 0.5rem;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }

        /* Empty state improvements */
        .room-service-empty-state {
            text-align: center;
            padding: 2rem;
            color: #9ca3af;
        }

        .room-service-empty-state .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
        }

        .room-service-empty-state p {
            margin: 0.5rem 0;
        }

        .room-service-empty-state button {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .room-service-empty-state button:hover {
            background: #4338ca;
            transform: translateY(-2px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border: 3px solid #000;
            border-radius: 12px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { 
                transform: scale(0.8) translateY(-50px);
                opacity: 0;
            }
            to { 
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #1f2937;
        }

        .modal-close {
            background: #f3f4f6;
            border: 2px solid #d1d5db;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: #6b7280;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: #e5e7eb;
            color: #374151;
        }

        .modal-content {
            margin-bottom: 1.5rem;
        }

        .table-details {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .detail-row:last-child {
            margin-bottom: 0;
        }

        .detail-label {
            font-weight: 600;
            color: #4b5563;
        }

        .detail-value {
            color: #1f2937;
        }

        .modal-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .modal-btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid #000;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .modal-btn.primary {
            background: #10b981;
            color: white;
            border-color: #059669;
        }

        .modal-btn.primary:hover {
            background: #059669;
            transform: translateY(-1px);
        }

        .modal-btn.secondary {
            background: #f1f5f9;
            color: #4a5568;
            border-color: #e2e8f0;
        }

        .modal-btn.secondary:hover {
            background: #e2e8f0;
            border-color: #cbd5e0;
        }

        .modal-btn.warning {
            background: #f59e0b;
            color: white;
            border-color: #d97706;
        }

        .modal-btn.warning:hover {
            background: #d97706;
        }

        .modal-btn.danger {
            background: #dc2626;
            color: white;
            border-color: #b91c1c;
        }

        .modal-btn.danger:hover {
            background: #b91c1c;
        }        .modal-btn.full-width {
            grid-column: 1 / -1;
        }

        /* Tables Selection Modal */
        .tables-selection-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .table-selection-item {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .table-selection-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }        .table-selection-item.available {
            background: #f0fdf4;
            border-color: #059669;
            opacity: 0.6;
            cursor: not-allowed;
        }

        .table-selection-item.available:hover {
            border-color: #059669;
            background: #f0fdf4;
            transform: none;
            box-shadow: none;
        }

        .table-selection-item.occupied {
            background: #fef2f2;
            border-color: #dc2626;
        }

        .table-selection-item.occupied:hover {
            border-color: #b91c1c;
            background: #fee2e2;
        }

        .table-selection-item.reserved {
            background: #fef3c7;
            border-color: #f59e0b;
            opacity: 0.6;
            cursor: not-allowed;
        }

        .table-selection-item.reserved:hover {
            border-color: #f59e0b;
            background: #fef3c7;
            transform: none;
            box-shadow: none;
        }

        .table-selection-number {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
            color: #1a202c;
        }

        .table-selection-status {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .table-selection-item.available .table-selection-status {
            color: #059669;
        }

        .table-selection-item.occupied .table-selection-status {
            color: #dc2626;
        }

        .table-selection-item.reserved .table-selection-status {
            color: #f59e0b;
        }

        .table-selection-capacity {
            position: absolute;
            top: 0.25rem;
            right: 0.25rem;
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .table-selection-info {
            font-size: 0.6rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }

        .order-items {
            flex: 1;
            padding: 1rem 1.5rem;
            overflow-y: auto;
            min-height: 0;
        }.order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .item-details {
            flex: 1;
        }

        .item-details h4 {
            margin: 0 0 0.25rem 0;
            font-size: 0.95rem;
            color: #1a202c;
        }

        .item-quantity {
            font-size: 0.85rem;
            color: #6b7280;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .qty-btn {
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: bold;
            transition: all 0.2s;
        }

        .qty-btn:hover {
            background: #e2e8f0;
            border-color: #cbd5e0;
        }

        .qty-display {
            min-width: 30px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .remove-item {
            background: #fef2f2;
            color: #dc2626;
            border-color: #fecaca;
        }

        .remove-item:hover {
            background: #fee2e2;
            border-color: #fca5a5;
        }

        .item-total {
            font-weight: 600;
            color: #059669;
        }

        .empty-cart {
            text-align: center;
            padding: 3rem 1rem;
            color: #9ca3af;
        }

        .empty-cart-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        /* Order Summary */
        .order-summary {
            padding: 1rem 1.5rem;
            border-top: 2px solid #000;
            background: #f8fafc;
            flex-shrink: 0;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .summary-row.total {
            font-size: 1.2rem;
            font-weight: bold;
            padding-top: 0.5rem;
            border-top: 2px solid #e2e8f0;
            margin-top: 0.5rem;
        }

        /* Action Buttons */
        .order-actions {
            padding: 1.5rem;
            background: white;
            flex-shrink: 0;
        }

        .pay-button {
            width: 100%;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 1rem;
            transition: all 0.2s;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .pay-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .pay-button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .secondary-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }

        .secondary-btn {
            background: #f1f5f9;
            color: #4a5568;
            border: 1px solid #e2e8f0;
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .secondary-btn:hover {
            background: #e2e8f0;
            border-color: #cbd5e0;
        }

        .clear-btn {
            grid-column: 1 / -1;
            background: #fef2f2;
            color: #dc2626;
            border-color: #fecaca;
        }

        .clear-btn:hover {
            background: #fee2e2;
            border-color: #fca5a5;
        }

        /* Notification Animations */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* Floor Plan Legend */
        .floor-plan-legend {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            border: 2px solid #000;
            padding: 1rem;
            border-radius: 8px;
            font-size: 0.875rem;
            z-index: 100;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border: 2px solid #000;
            margin-right: 0.5rem;
            border-radius: 2px;
        }

        .legend-color.available { background: #f0fdf4; border-color: #059669; }
        .legend-color.occupied { background: #fef2f2; border-color: #dc2626; }
        .legend-color.reserved { background: #fef3c7; border-color: #f59e0b; }
        .legend-color.selected { background: #dbeafe; border-color: #3b82f6; }        /* Responsive floor plan */
        @media (max-width: 768px) {
            .floor-plan-canvas {
                min-height: 400px;
            }
            
            .floor-plan-legend {
                position: static;
                margin-bottom: 1rem;
            }
            
            .floor-plan-table {
                min-width: 60px;
                min-height: 60px;
            }
        }

        /* Table Tags Styles */
        .table-tags {
            margin-top: 0.5rem;
        }

        .table-tag {
            display: inline-block;
            background: #3b82f6;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-right: 0.5rem;
            margin-bottom: 0.25rem;
            border: 1px solid #2563eb;
        }

        .table-tag.birthday { background: #f59e0b; border-color: #d97706; }
        .table-tag.anniversary { background: #ec4899; border-color: #db2777; }
        .table-tag.vip { background: #8b5cf6; border-color: #7c3aed; }
        .table-tag.celebration { background: #10b981; border-color: #059669; }
        .table-tag.business { background: #6b7280; border-color: #4b5563; }
        .table-tag.date { background: #ef4444; border-color: #dc2626; }

        .tag-selection-modal {
            max-width: 400px;
        }

        .tag-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin: 1rem 0;
        }

        .tag-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tag-option:hover {
            border-color: #3b82f6;
            background: #f8fafc;
        }        .tag-option input[type="checkbox"] {
            width: 16px;
            height: 16px;
        }

        .custom-tag-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.9rem;
            font-family: 'Courier New', monospace;
            transition: all 0.2s;
        }

        .custom-tag-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }.tag-preview {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.75rem;
            font-weight: 500;
            border: 1px solid;
            margin: 1px;
        }

        /* Updated tag preview colors with visible text */
        .tag-preview.birthday {
            background-color: #fce7f3;
            color: #be185d;
            border-color: #f9a8d4;
        }

        .tag-preview.anniversary {
            background-color: #fdf2f8;
            color: #be185d;
            border-color: #f9a8d4;
        }

        .tag-preview.vip {
            background-color: #fef3c7;
            color: #92400e;
            border-color: #fbbf24;
        }

        .tag-preview.celebration {
            background-color: #ecfdf5;
            color: #065f46;
            border-color: #6ee7b7;
        }

        .tag-preview.business {
            background-color: #eff6ff;
            color: #1e40af;
            border-color: #93c5fd;
        }

        .tag-preview.date-night {
            background-color: #f3e8ff;
            color: #7c3aed;
            border-color: #c4b5fd;
        }

        .tag-preview.custom {
            background-color: #f1f5f9;
            color: #475569;
            border-color: #cbd5e1;
        }        /* Drag Selection and Grouping Styles */
        .floor-plan-table.drag-selected {
            border: 3px solid #3b82f6 !important;
            box-shadow: 
                0 0 0 3px rgba(59, 130, 246, 0.4),
                0 8px 24px rgba(59, 130, 246, 0.25),
                0 4px 12px rgba(0, 0, 0, 0.1) !important;
            z-index: 15;
            transform: translateY(-2px) scale(1.02);
        }

        .floor-plan-table.grouped {
            border: 3px solid #8b5cf6 !important;
            background: linear-gradient(135deg, 
                rgba(139, 92, 246, 0.15) 0%, 
                rgba(139, 92, 246, 0.08) 50%,
                rgba(255, 255, 255, 0.9) 100%) !important;
            box-shadow: 
                0 6px 20px rgba(139, 92, 246, 0.2),
                0 3px 8px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
        }

        .floor-plan-table.grouped::after {
            content: "📎";
            position: absolute;
            top: -8px;
            right: -8px;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            z-index: 16;
            box-shadow: 
                0 2px 8px rgba(139, 92, 246, 0.4),
                0 1px 3px rgba(0, 0, 0, 0.2);
            border: 2px solid white;
        }

        /* Marquee Selection Box */
        .table-selection-marquee {
            position: absolute;
            border: 2px dashed #3b82f6;
            background: linear-gradient(135deg, 
                rgba(59, 130, 246, 0.1) 0%, 
                rgba(59, 130, 246, 0.05) 100%);
            display: none;
            z-index: 1000;
            pointer-events: none;
            border-radius: 8px;
            backdrop-filter: blur(4px);
        }        /* Context Menu for Table Grouping */
        .table-context-menu {
            position: absolute;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 2px solid #000;
            border-radius: 12px;
            box-shadow: 
                0 12px 32px rgba(0, 0, 0, 0.2),
                0 4px 16px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            z-index: 2000;
            min-width: 200px;
            display: none;
            backdrop-filter: blur(8px);
            overflow: hidden;
        }

        .context-menu-item {
            padding: 0.875rem 1.25rem;
            cursor: pointer;
            border-bottom: 1px solid rgba(229, 231, 235, 0.6);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 500;
            color: #374151;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            background: transparent;
        }

        .context-menu-item:last-child {
            border-bottom: none;
        }

        .context-menu-item:hover {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            color: #1f2937;
            transform: translateX(2px);
        }

        .context-menu-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            color: #9ca3af;
        }

        .context-menu-item.disabled:hover {
            background: transparent;
            transform: none;
        }        /* Group indicator for multiple selected tables */
        .group-info-badge {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.7rem;
            font-weight: 700;
            z-index: 17;
            white-space: nowrap;
            box-shadow: 
                0 4px 12px rgba(59, 130, 246, 0.4),
                0 2px 6px rgba(0, 0, 0, 0.1);
            border: 2px solid white;
            letter-spacing: 0.025em;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        /* ...existing code... */    </style>
    <script src="hotel-mode.js"></script>
    <script src="multi-property-manager.js"></script>
    <script src="property-switcher.js"></script>
</head>
<body>
    <div class="pos-container">
        <!-- Header -->
        <header class="pos-header">            <div class="header-left">
                <div class="system-name">Macros POS LOL</div>
                <div class="account-info">John Smith (Manager)</div>
                <div class="hotel-name">Grand Hotel & Restaurant</div>
                <!-- Property Switcher -->
                <div id="propertySwitcher" class="property-switcher" style="display: none;">
                    <select id="propertySelect" class="property-select">
                        <option value="">Loading properties...</option>
                    </select>
                </div>
            </div><div class="header-tabs">
                <button class="tab-button" onclick="switchTab('tables')">Tables</button>
                <button class="tab-button active" onclick="switchTab('menu')">Menu</button>
                <button class="tab-button" onclick="switchTab('kitchen')">Kitchen</button>
                <button class="tab-button" id="roomServiceTab" onclick="switchTab('roomservice')">🛎️ Room Service</button>
            </div><div class="header-actions">
                <button class="header-btn" title="Help & Support" onclick="window.open('help.html', '_blank')">📚 Help</button>
                <button class="header-btn" title="General Settings" onclick="openGeneralSettings()">⚙️ Settings</button>
                <button class="header-btn" title="Business Settings" onclick="openBusinessSettings()">🏢 Business</button>
                <button class="header-btn" id="superAdminDashboardBtn" title="Return to Super Admin Dashboard" onclick="returnToSuperAdminDashboard()" style="display: none; background: linear-gradient(135deg, #ffd700, #ffed4e); color: #000; font-weight: bold;">
                    👑 Dashboard
                </button>
                <button class="header-btn" title="Logout" onclick="logout()">Log Out</button>
            </div>
        </header>        <!-- Main Content -->
        <main class="pos-main">
            <!-- Menu View -->
            <section class="menu-panel" id="menuView">
                <div class="menu-panel::before-content">Menu Section</div>                <div class="menu-grid" id="menuGrid">
                    <!-- Menu items will be populated by JavaScript from menu editor -->
                </div>
            </section>            <!-- Kitchen View -->
            <section class="kitchen-panel" id="kitchenView" style="display: none;">
                <div class="kitchen-header">
                    <h2>Kitchen - Orders in Progress</h2>
                </div>
                <div class="kitchen-orders" id="kitchenOrders">
                    <!-- Kitchen orders will be populated by JavaScript -->
                </div>
            </section>            <!-- Tables View -->
            <section class="tables-panel" id="tablesView" style="display: none;">
                <div class="kitchen-header">
                    <h2>Restaurant Floor Plan</h2>
                    <div style="display: flex; gap: 1rem; align-items: center; margin-top: 0.5rem;">
                        <span style="font-size: 0.8rem; color: #6b7280;">💡 Drag to select multiple tables • Right-click to group/ungroup</span>
                        <button id="clearSelectionBtn" onclick="clearTableSelections()" style="display: none; padding: 0.25rem 0.5rem; font-size: 0.75rem; background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 4px; cursor: pointer;">Clear Selection</button>
                    </div>
                </div>                  <div class="floor-plan-container" id="floorPlanContainer" style="position: relative; flex: 1; padding: 1rem; overflow: auto; min-height: 700px;">
                    <div class="floor-plan-canvas" id="floorPlanCanvas" style="position: relative; min-height: 600px; height: auto; background: #f8fafc; border: 2px dashed #e7e7eb; border-radius: 8px;">
                        <!-- Tables will be rendered here -->
                    </div>
                      <!-- Marquee Selection Box -->
                    <div class="table-selection-marquee" id="tableSelectionMarquee"></div>
                </div>
            </section>            <!-- Room Service View -->
            <section class="room-service-panel" id="roomServiceView" style="display: none;">
                <!-- Room Service Header -->
                <div class="room-service-header">
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                        <span style="font-size: 2rem;">🛎️</span>
                        <h2 style="margin: 0; font-size: 1.5rem;">Room Service</h2>
                        <span id="loyaltyProgramName" style="margin-left: auto; font-size: 0.9rem; opacity: 0.9;">Hotel Loyalty Program</span>
                    </div>
                    <p style="margin: 0; opacity: 0.9;">Professional in-room dining service</p>
                </div>                <!-- Three Column Layout: Guest Info | Menu | Order Cart -->
                <div class="room-service-content">
                    
                    <!-- Left Column: Guest Information -->
                    <div class="guest-info-column">
                        <div style="background: white; border: 2px solid #000; border-radius: 8px; padding: 1.5rem; flex-shrink: 0;">
                            <h3 style="margin: 0 0 1rem 0; color: #374151; display: flex; align-items: center; gap: 0.5rem;">
                                <span>👤</span>
                                <span>Guest Information</span>
                            </h3>
                            <div style="display: flex; flex-direction: column; gap: 1rem;">
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151;">Guest Name</label>
                                    <input type="text" id="guestName" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 6px; font-family: inherit;" placeholder="Enter guest name" required>
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151;">Room Number</label>
                                    <input type="text" id="roomNumber" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 6px; font-family: inherit;" placeholder="e.g., 1205" required>
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151;">Loyalty Status</label>
                                    <select id="loyaltyStatus" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 6px; font-family: inherit;">
                                        <option value="">Select loyalty status</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Order Summary Panel -->
                        <div style="background: white; border: 2px solid #000; border-radius: 8px; padding: 1.5rem; flex: 1; display: flex; flex-direction: column;">
                            <h4 style="margin: 0 0 1rem 0; color: #374151; display: flex; align-items: center; gap: 0.5rem;">
                                <span>📋</span>
                                <span>Order Summary</span>
                            </h4>
                            <div id="roomServiceOrderSummary" style="font-family: monospace; background: #f8fafc; padding: 1rem; border-radius: 6px; border: 1px solid #e5e7eb; flex: 1;">
                                <div style="color: #6b7280; text-align: center; padding: 1rem;">
                                    No items selected yet
                                </div>
                            </div>
                        </div>
                    </div>                    <!-- Middle Column: Menu -->
                    <div class="menu-column">
                        <div style="background: #f8fafc; padding: 1rem; border-bottom: 2px solid #e5e7eb; font-weight: bold; color: #374151; display: flex; align-items: center; gap: 0.5rem; flex-shrink: 0;">
                            <span>🍽️</span>
                            <span>Room Service Menu</span>
                            <span style="margin-left: auto; font-size: 0.75rem; opacity: 0.8;" id="menuSyncStatus">Synced with Restaurant</span>
                        </div>
                        
                        <!-- Menu Search -->
                        <div style="padding: 1rem; border-bottom: 1px solid #e5e7eb; flex-shrink: 0;">
                            <input type="text" id="menuSearch" placeholder="Search menu items...">
                        </div>
                        
                        <!-- Menu Grid -->
                        <div id="roomServiceMenuGrid">
                            <!-- Menu items will be populated by JavaScript -->
                            <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #9ca3af;">
                                <span style="font-size: 3rem;">🍽️</span>
                                <p>Loading menu items...</p>
                            </div>
                        </div>
                    </div>                    <!-- Right Column: Order Cart -->
                    <div class="cart-column">
                        <div style="background: #f8fafc; padding: 1rem; border-bottom: 2px solid #e5e7eb; font-weight: bold; color: #374151; display: flex; align-items: center; gap: 0.5rem; flex-shrink: 0;">
                            <span>🛒</span>
                            <span>Order Cart</span>
                            <span style="margin-left: auto;" id="roomServiceCartCount">0 items</span>
                        </div>
                        
                        <!-- Cart Items -->
                        <div id="roomServiceCartItems">
                            <div style="text-align: center; color: #9ca3af; padding: 2rem;">
                                <span style="font-size: 3rem;">🛎️</span>
                                <p>Add items to start the order</p>
                                <p style="font-size: 0.8rem;">Click items from the menu to add them</p>
                            </div>
                        </div>

                        <!-- Cart Totals -->
                        <div id="roomServiceCartTotal" style="display: none; border-top: 2px solid #e5e7eb; padding: 1rem; flex-shrink: 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Subtotal:</span>
                                <span id="roomServiceSubtotal">$0.00</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Service Charge (18%):</span>
                                <span id="roomServiceServiceCharge">$0.00</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Tax (8.75%):</span>
                                <span id="roomServiceTax">$0.00</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 1.1rem; border-top: 2px solid #374151; padding-top: 0.5rem; margin-bottom: 1rem;">
                                <span>Total:</span>
                                <span id="roomServiceTotal">$0.00</span>
                            </div>
                        </div>

                        <!-- Special Instructions -->
                        <div style="border-top: 1px solid #e5e7eb; padding: 1rem; flex-shrink: 0;">
                            <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151; font-size: 0.9rem;">Special Instructions</label>
                            <textarea id="specialInstructions" style="width: 100%; padding: 0.5rem; border: 2px solid #e5e7eb; border-radius: 4px; font-family: inherit; height: 60px; font-size: 0.9rem; resize: none;" placeholder="Dietary requirements, preferences..."></textarea>
                        </div>                        <!-- Checkout Buttons -->
                        <div style="padding: 1rem; border-top: 1px solid #e5e7eb; flex-shrink: 0;">
                            <button id="roomServiceCheckoutBtn" onclick="handleRoomServiceOrder(event)" style="width: 100%; background: linear-gradient(135deg, #4f46e5, #7c3aed); color: white; border: none; padding: 1rem; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 1rem;" disabled>
                                <span style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                                    <span>🚀</span>
                                    <span>Send to Kitchen</span>
                                </span>
                            </button>
                            
                            <button id="roomServicePrintBtn" onclick="openPrintOrderModal()" class="print-order-btn" style="width: 100%;" disabled>
                                <span>🖨️</span>
                                <span>Print Order</span>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Right Panel - Order Cart (Separate from tables view) -->
            <section class="order-panel">
                <div class="order-header">
                    <!-- Order Cart title handled by CSS ::before -->                    <div class="table-indicator" id="tableIndicator">
                        <span id="tableNumber">Table 1</span>
                        <button class="table-close-btn" onclick="cancelTableOrder()" title="Cancel table order">×</button>
                    </div>
                </div>

                <div class="order-items" id="orderItems">
                    <div class="empty-cart">
                        <div class="empty-cart-icon">🛒</div>
                        <p>Your cart is empty</p>
                        <p style="font-size: 0.8rem;">Add items from the menu to get started</p>
                    </div>
                </div>

                <div class="order-summary" id="orderSummary" style="display: none;">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">$0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>Tax (8.5%):</span>
                        <span id="tax">$0.00</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total:</span>
                        <span id="total">$0.00</span>
                    </div>
                </div>

                <div class="order-actions">
                    <button class="pay-button" id="payButton" disabled onclick="processPayment()">
                        💳 Pay Now
                    </button>                      <div class="secondary-actions">
                        <button class="secondary-btn" onclick="printCheck()">🖨️ Print Check</button>
                        <button class="secondary-btn" onclick="editCheck()">✏️ Edit Check</button>
                        <button class="secondary-btn" onclick="voidCheck()">❌ Void Check</button>
                        <button class="secondary-btn" onclick="showTablesModal()">🏪 Show Tables</button>
                        <button class="secondary-btn" onclick="clearTableSelection()" id="clearTableBtn" style="display: none;">🏪 Clear Table</button>
                        <button class="secondary-btn clear-btn" onclick="clearCart()">🗑️ Clear Cart</button>
                    </div>
                </div>
            </section>
        </main>

            <!-- Table Context Menu for Grouping -->
    <div class="table-context-menu" id="tableContextMenu">
        <div class="context-menu-item" id="groupTablesMenuItem" onclick="groupSelectedTables()">
            <span>🔗</span> Group Tables
        </div>
        <div class="context-menu-item" id="ungroupTableMenuItem" onclick="ungroupTable()" style="display: none;">
            <span>🔓</span> Ungroup Table
        </div>
        <div class="context-menu-item" onclick="selectTable(contextMenuTableId)">
            <span>📋</span> Table Details
        </div>
    </div>

    <!-- Table Action Modal -->
    <div class="modal-overlay" id="tableModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Table Actions</h3>
                <button class="modal-close" onclick="closeTableModal()">×</button>
            </div>
            <div class="modal-content">
                <div class="table-details" id="modalTableDetails">
                    <!-- Table details will be populated by JavaScript -->
                </div>
                <div class="modal-actions" id="modalActions">
                    <!-- Action buttons will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Tables Selection Modal -->
    <div class="modal-overlay" id="tablesSelectionModal">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title">Select a Table</h3>
                <button class="modal-close" onclick="closeTablesSelectionModal()">×</button>
            </div>
            <div class="modal-content">
                <div class="tables-selection-grid" id="tablesSelectionGrid">
                    <!-- Tables will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>    <!-- Table Tags Modal -->
    <div class="modal-overlay" id="tableTagsModal">
        <div class="modal tag-selection-modal">
            <div class="modal-header">
                <h3 class="modal-title" id="tagsModalTitle">Table Tags</h3>
                <button class="modal-close" onclick="closeTableTagsModal()">×</button>
            </div>
            <div class="modal-content">
                <p style="margin-bottom: 1rem; color: #6b7280; font-size: 0.9rem;">Select special events or occasions for this table:</p>
                
                <div class="tag-options">
                    <div class="tag-option" onclick="toggleTag('birthday')">
                        <input type="checkbox" id="tag-birthday">
                        <span class="tag-preview birthday">🎂 Birthday</span>
                    </div>
                    <div class="tag-option" onclick="toggleTag('anniversary')">
                        <input type="checkbox" id="tag-anniversary">
                        <span class="tag-preview anniversary">💕 Anniversary</span>
                    </div>
                    <div class="tag-option" onclick="toggleTag('vip')">
                        <input type="checkbox" id="tag-vip">
                        <span class="tag-preview vip">👑 VIP</span>
                    </div>
                    <div class="tag-option" onclick="toggleTag('celebration')">
                        <input type="checkbox" id="tag-celebration">
                        <span class="tag-preview celebration">🎉 Celebration</span>
                    </div>
                    <div class="tag-option" onclick="toggleTag('business')">
                        <input type="checkbox" id="tag-business">
                        <span class="tag-preview business">💼 Business</span>
                    </div>
                    <div class="tag-option" onclick="toggleTag('date')">
                        <input type="checkbox" id="tag-date">
                        <span class="tag-preview date">❤️ Date Night</span>
                    </div>
                </div>
                
                <div style="margin-top: 1rem;">
                    <label for="customTagInput" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Custom Tag:</label>
                    <input type="text" id="customTagInput" class="custom-tag-input" placeholder="Enter custom event/occasion..." maxlength="20">
                </div>
                  <div style="display: flex; gap: 0.75rem; margin-top: 1.5rem;">
                    <button class="modal-btn primary" onclick="saveTableTags()" style="flex: 1;">💾 Save Tags</button>
                    <button class="modal-btn secondary" onclick="clearAllTags()" style="flex: 1;">🗑️ Clear All</button>
                    <button class="modal-btn secondary" onclick="closeTableTagsModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reservation Modal -->
    <div class="modal-overlay" id="reservationModal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title" id="reservationModalTitle">Make Reservation</h3>
                <button class="modal-close" onclick="closeReservationModal()">×</button>
            </div>
            <div class="modal-content">
                <form id="reservationForm" onsubmit="submitReservation(event)" style="display: flex; flex-direction: column; gap: 1.5rem;">
                    <!-- Customer Information -->
                    <div class="form-section">
                        <h4 style="margin: 0 0 1rem 0; color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem;">Customer Information</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label for="customerName" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Customer Name *</label>
                                <input type="text" id="customerName" name="customerName" required 
                                       style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 6px; font-family: inherit; font-size: 1rem;" 
                                       placeholder="Enter full name">
                            </div>
                            
                            <div class="form-group">
                                <label for="customerPhone" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Phone Number *</label>
                                <input type="tel" id="customerPhone" name="customerPhone" required 
                                       style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 6px; font-family: inherit; font-size: 1rem;" 
                                       placeholder="(555) 123-4567">
                            </div>
                        </div>
                        
                        <div class="form-group" style="margin-top: 1rem;">
                            <label for="customerEmail" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Email (Optional)</label>
                            <input type="email" id="customerEmail" name="customerEmail" 
                                   style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 6px; font-family: inherit; font-size: 1rem;" 
                                   placeholder="customer@example.com">
                        </div>
                    </div>

                    <!-- Reservation Details -->
                    <div class="form-section">
                        <h4 style="margin: 0 0 1rem 0; color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem;">Reservation Details</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label for="reservationDate" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Date *</label>
                                <input type="date" id="reservationDate" name="reservationDate" required 
                                       style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 6px; font-family: inherit; font-size: 1rem;">
                            </div>
                            
                            <div class="form-group">
                                <label for="reservationTime" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Time *</label>
                                <input type="time" id="reservationTime" name="reservationTime" required 
                                       style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 6px; font-family: inherit; font-size: 1rem;">
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                            <div class="form-group">
                                <label for="partySize" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Party Size *</label>
                                <select id="partySize" name="partySize" required 
                                        style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 6px; font-family: inherit; font-size: 1rem; background: white;">
                                    <option value="">Select party size</option>
                                    <option value="1">1 person</option>
                                    <option value="2">2 people</option>
                                    <option value="3">3 people</option>
                                    <option value="4">4 people</option>
                                    <option value="5">5 people</option>
                                    <option value="6">6 people</option>
                                    <option value="7">7 people</option>
                                    <option value="8">8 people</option>
                                    <option value="9">9+ people</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="occasion" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Special Occasion</label>
                                <select id="occasion" name="occasion" 
                                        style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 6px; font-family: inherit; font-size: 1rem; background: white;">
                                    <option value="">None</option>
                                    <option value="birthday">Birthday 🎂</option>
                                    <option value="anniversary">Anniversary 💕</option>
                                    <option value="date">Date Night ❤️</option>
                                    <option value="business">Business Meeting 💼</option>
                                    <option value="celebration">Celebration 🎉</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Special Requests -->
                    <div class="form-section">
                        <h4 style="margin: 0 0 1rem 0; color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem;">Special Requests</h4>
                        
                        <div class="form-group">
                            <label for="specialRequests" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Notes & Special Requests</label>
                            <textarea id="specialRequests" name="specialRequests" rows="3" 
                                      style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 6px; font-family: inherit; font-size: 1rem; resize: vertical;" 
                                      placeholder="Dietary restrictions, accessibility needs, special celebrations, etc."></textarea>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" id="highChair" name="highChair" style="margin: 0;">
                                    <span style="font-weight: 600; color: #374151;">Need High Chair</span>
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" id="wheelchair" name="wheelchair" style="margin: 0;">
                                    <span style="font-weight: 600; color: #374151;">Wheelchair Accessible</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 1rem; margin-top: 1rem; padding-top: 1rem; border-top: 2px solid #e5e7eb;">
                        <button type="submit" class="modal-btn primary" style="flex: 1;">
                            📝 Confirm Reservation
                        </button>
                        <button type="button" class="modal-btn secondary" onclick="closeReservationModal()">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>// POS System JavaScript
        let cart = [];
        let orderTotal = 0;
        let currentView = 'menu';
        let selectedTable = null;        let kitchenOrders = [];
        let menuItems = []; // Will be loaded from localStorage        // Get property context for storage
        function getPropertyContext() {
            try {
                // Check for current business context first
                const businessContext = localStorage.getItem('currentBusinessContext');
                if (businessContext) {
                    return JSON.parse(businessContext);
                }
                
                // Check for current property context
                const propertyContext = localStorage.getItem('currentPropertyContext');
                if (propertyContext) {
                    return JSON.parse(propertyContext);
                }
                
                // Check for selected property information
                const selectedProperty = localStorage.getItem('selectedProperty');
                if (selectedProperty) {
                    return JSON.parse(selectedProperty);
                }
            } catch (error) {
                console.error("Error getting property context:", error);
            }
            
            return null;
        }
            
        // Load menu items from property-specific storage
        function loadMenuItems() {
            try {
                // Get current property context
                const propertyContext = getPropertyContext();
                
                if (propertyContext && propertyContext.id) {
                    // Load from property-specific storage
                    const propertyMenuKey = `property_${propertyContext.id}_menu`;
                    const savedMenu = localStorage.getItem(propertyMenuKey);
                    
                    if (savedMenu) {
                        menuItems = JSON.parse(savedMenu);
                        console.log(`Loaded menu data for property: ${propertyContext.name} (ID: ${propertyContext.id})`);
                    } else {
                        // If no property-specific menu, check global storage as fallback
                        const globalMenu = localStorage.getItem('menuItems');
                        if (globalMenu) {
                            menuItems = JSON.parse(globalMenu);
                            console.log("Loaded menu data from global storage (fallback)");
                        }
                    }
                } else {
                    // No property context, try global storage
                    const savedMenu = localStorage.getItem('menuItems');
                    if (savedMenu) {
                        menuItems = JSON.parse(savedMenu);
                        console.log("Loaded menu data from global storage (no property context)");
                    }
                }
            } catch (error) {
                console.error("Error loading menu data:", error);
                // Fallback to global storage
                const savedMenu = localStorage.getItem('menuItems');
                if (savedMenu) {
                    menuItems = JSON.parse(savedMenu);
                }
            }
            
            renderMenuGrid();
        }

        // === 86 FUNCTIONALITY ===
        
        // Get today's day name
        function getTodayName() {
            const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            return days[new Date().getDay()];
        }

        // Check if item is available today (considering 86 status)
        function isItemAvailableToday(item) {
            if (!item.available) return false;
            if (!item.dayAvailability) return true;
            
            const today = getTodayName();
            return item.dayAvailability[today] !== false;
        }

        // Render menu grid
        function renderMenuGrid() {
            const menuGrid = document.getElementById('menuGrid');
            
            if (menuItems.length === 0) {
                menuGrid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #9ca3af;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">🍽️</div>
                        <p>No menu items available</p>
                        <p style="font-size: 0.8rem; margin-bottom: 1rem;">Add items using the menu editor</p>
                        <button onclick="window.location.href='menu-editor.html'" style="background: #3b82f6; color: white; border: 2px solid #000; padding: 0.75rem 1.5rem; font-family: 'Courier New', monospace; cursor: pointer; border-radius: 4px;">
                            Open Menu Editor
                        </button>
                    </div>
                `;
                return;
            }

            // Filter available items only
            const availableItems = menuItems.filter(item => item.available);
            
            if (availableItems.length === 0) {
                menuGrid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #9ca3af;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">😴</div>
                        <p>No items available for ordering</p>
                        <p style="font-size: 0.8rem;">All menu items are currently unavailable</p>
                    </div>
                `;
                return;
            }

            menuGrid.innerHTML = availableItems.map(item => `
                <div class="menu-item" onclick="addToCart('${item.id}', '${item.name}', ${item.price})">
                    <div class="item-image">${item.emoji}</div>
                    <div class="item-name">${item.name}</div>
                    <div class="item-price">$${item.price.toFixed(2)}</div>
                    <div class="item-actions">
                        <button class="item-btn customize-btn" onclick="event.stopPropagation(); customizeItem('${item.id}')">Customize</button>
                        <button class="item-btn details-btn" onclick="event.stopPropagation(); showDetails('${item.id}')">Details</button>
                    </div>
                </div>
            `).join('');
        }
        
        // Initialize the POS system
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication first
            // TEMPORARILY DISABLED FOR DEVELOPMENT
            // checkAuthentication();
            
            // Load menu items from property-specific storage            loadMenuItems();
            initializeTables();
            
            // Load user account information
            // TEMPORARILY DISABLED FOR DEVELOPMENT
            // loadUserAccount();
            
            // Add temporary user info for development
            const accountInfo = document.querySelector('.account-info');
            const hotelName = document.querySelector('.hotel-name');
            if (accountInfo) accountInfo.textContent = 'Developer (Testing Mode)';
            if (hotelName) hotelName.textContent = 'Development Restaurant';
            
            // Check for super admin access and show notification
            const superAdminAccess = localStorage.getItem('superAdminPOSAccess');            if (superAdminAccess === 'true') {
                setTimeout(() => {
                    showSuperAdminWelcomeNotification();
                }, 1000);
            }
            
            // Initialize role-based UI
            setTimeout(() => {
                initializeRoleBasedUI();
            }, 100);
        });
        // End of DOMContentLoaded event handler
        
        // Switch between tabs
        function switchTab(view) {
            currentView = view;
            const menuView = document.getElementById('menuView');
            const kitchenView = document.getElementById('kitchenView');
            const tablesView = document.getElementById('tablesView');
            const roomServiceView = document.getElementById('roomServiceView');
            const orderPanel = document.querySelector('.order-panel');
            const tabButtons = document.querySelectorAll('.tab-button');
            
            // Update active tab
            tabButtons.forEach(btn => {
                btn.classList.remove('active');
                // Check if this button corresponds to the current view
                if ((view === 'menu' && btn.textContent.includes('Menu')) ||
                    (view === 'kitchen' && btn.textContent.includes('Kitchen')) ||
                    (view === 'tables' && btn.textContent.includes('Tables')) ||
                    (view === 'roomservice' && btn.textContent.includes('Room Service'))) {
                    btn.classList.add('active');
                }
            });
            
            // Hide all views first
            if (menuView) menuView.style.display = 'none';
            if (kitchenView) kitchenView.style.display = 'none';
            if (tablesView) tablesView.style.display = 'none';
            if (roomServiceView) roomServiceView.style.display = 'none';
            
            // Show the selected view and manage order cart visibility
            if (view === 'menu') {
                if (menuView) menuView.style.display = 'block';
                if (orderPanel) orderPanel.style.display = 'block'; // Show order cart for menu
            } else if (view === 'kitchen') {
                if (kitchenView) kitchenView.style.display = 'block';
                if (orderPanel) orderPanel.style.display = 'none'; // Hide order cart for kitchen
                updateKitchenDisplay();
            } else if (view === 'tables') {
                if (tablesView) tablesView.style.display = 'block';
                if (orderPanel) orderPanel.style.display = 'none'; // Hide order cart for tables
                console.log('Switching to tables view - initializing tables...');
                initializeTables();
                // Ensure floor plan is rendered before initializing drag selection
                setTimeout(() => {
                    console.log('Rendering tables and initializing additional features...');
                    renderTables(); // Explicitly call renderTables to ensure floor plan is rendered
                    initializeTableDragSelection();
                    initializeTableContextMenu();
                    loadTableGroups();
                }, 150); // Slightly longer timeout to ensure rendering completes
            } else if (view === 'roomservice') {
                if (roomServiceView) {
                    roomServiceView.style.display = 'block';
                    if (orderPanel) orderPanel.style.display = 'none'; // Hide order cart for room service
                    initializeRoomService();
                }
            }
        }

        // Update kitchen display
        function updateKitchenDisplay() {
            const kitchenOrdersContainer = document.getElementById('kitchenOrders');
            
            if (kitchenOrders.length === 0) {
                kitchenOrdersContainer.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #9ca3af; grid-column: 1/-1;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">👨‍🍳</div>
                        <p>No orders in kitchen</p>
                        <p style="font-size: 0.8rem;">Orders will appear here when sent to kitchen</p>
                    </div>
                `;
                return;
            }

            kitchenOrdersContainer.innerHTML = kitchenOrders.map(order => `
                <div class="kitchen-order ${order.status}">
                    <div class="order-header">
                        <span class="order-number">Order ${order.id}</span>
                        <span class="order-status ${order.status}">${order.status}</span>
                    </div>
                    <div class="order-meta" style="margin-bottom: 1rem; font-size: 0.9rem; color: #6b7280;">
                        <div>Table: ${order.table}</div>
                        <div>Time: ${order.time} (${order.totalTime})</div>
                    </div>
                    <div class="order-items-list">
                        ${order.items.map(item => `
                            <div class="kitchen-item">
                                <span class="item-name-qty">${item.quantity}x ${item.name}</span>
                                <span>$${(item.quantity * item.price).toFixed(2)}</span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="status-buttons">
                        ${order.status === 'preparing' ? `
                            <button class="status-btn ready" onclick="updateOrderStatus('${order.id}', 'ready')">Mark Ready</button>
                        ` : ''}
                        ${order.status === 'ready' ? `
                            <button class="status-btn served" onclick="updateOrderStatus('${order.id}', 'served')">Mark Served</button>
                        ` : ''}
                        ${order.status === 'served' ? `
                            <button class="status-btn" onclick="removeOrder('${order.id}')" style="background: #dc2626;">Remove</button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Update order status in kitchen
        function updateOrderStatus(orderId, newStatus) {
            const order = kitchenOrders.find(o => o.id === orderId);
            if (order) {
                order.status = newStatus;
                updateKitchenDisplay();
                showNotification(`Order ${orderId} marked as ${newStatus}!`, 'success');
            }
        }

        // Remove order from kitchen
        function removeOrder(orderId) {
            kitchenOrders = kitchenOrders.filter(o => o.id !== orderId);
            updateKitchenDisplay();
            showNotification(`Order ${orderId} removed from kitchen!`, 'info');
        }        // Add item to cart
        function addToCart(id, name, price, modifiers = [], priceAdjustment = 0) {
            // When modifiers are present, always add as a new item to keep separate modifications
            if (modifiers && modifiers.length > 0) {
                const cartItem = {
                    id: id,
                    name: name,
                    price: price,
                    basePrice: price - priceAdjustment, // Store original price
                    priceAdjustment: priceAdjustment,
                    quantity: 1,
                    modifiers: modifiers,
                    specialRequests: '',
                    allergies: [],
                    uniqueId: `${id}_${Date.now()}` // Add unique identifier for modified items
                };
                cart.push(cartItem);
                updateCartDisplay();
                
                // Show a more descriptive notification for customized items
                const modifierText = ' (Customized)';
                const priceText = priceAdjustment !== 0 ? 
                    (priceAdjustment > 0 ? ` (+$${priceAdjustment.toFixed(2)})` : ` (-$${Math.abs(priceAdjustment).toFixed(2)})`) : '';
                    
                showNotification(`${name}${modifierText}${priceText} added to cart!`);
                return;
            }
            
            // Standard behavior for items without modifiers
            const existingItem = cart.find(item => item.id === id && (!item.modifiers || item.modifiers.length === 0));
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: id,
                    name: name,
                    price: price,
                    quantity: 1,
                    modifiers: [],
                    specialRequests: '',
                    allergies: []
                });
            }
            
            updateCartDisplay();
            showNotification(`${name} added to cart!`);
        }        // Update item quantity
        function updateQuantity(id, change) {
            // Check if this is a unique ID (for items with modifiers)
            let item = cart.find(item => item.uniqueId === id);
            
            if (!item) {
                item = cart.find(item => item.id === id);
            }
            
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    removeFromCart(item.uniqueId || item.id);
                } else {
                    updateCartDisplay();
                }
            }
        }// Remove item from cart
        function removeFromCart(id) {
            // Check if this is a unique ID (for items with modifiers)
            const uniqueItem = cart.find(item => item.uniqueId === id);
            if (uniqueItem) {
                cart = cart.filter(item => item.uniqueId !== id);
            } else {
                cart = cart.filter(item => item.id !== id);
            }
            updateCartDisplay();
            showNotification('Item removed from cart!', 'warning');
        }

        // Update cart display
        function updateCartDisplay() {
            const orderItems = document.getElementById('orderItems');
            const orderSummary = document.getElementById('orderSummary');
            const payButton = document.getElementById('payButton');

            if (cart.length === 0) {
                orderItems.innerHTML = `
                    <div class="empty-cart">
                        <div class="empty-cart-icon">🛒</div>
                        <p>Your cart is empty</p>
                        <p style="font-size: 0.8rem;">Add items from the menu to get started</p>
                    </div>
                `;
                orderSummary.style.display = 'none';
                payButton.disabled = true;
                return;
            }            orderItems.innerHTML = cart.map(item => `
                <div class="order-item">
                    <div class="item-details">
                        <h4>${item.name}</h4>
                        <div class="item-quantity">
                            $${item.price.toFixed(2)} each
                            ${item.priceAdjustment ? 
                                `<span style="font-size: 0.8rem; color: ${item.priceAdjustment > 0 ? '#ef4444' : '#10b981'}">
                                    (${item.priceAdjustment > 0 ? '+' : '-'}$${Math.abs(item.priceAdjustment).toFixed(2)})
                                </span>` : ''
                            }
                        </div>
                        ${item.modifiers && item.modifiers.length > 0 ? `
                            <div class="item-modifiers">
                                <div style="font-size: 0.9rem; color: #4b5563; margin-top: 8px;">
                                    ${item.modifiers.map(mod => `
                                        <div class="modifier-group" style="margin-bottom: 6px;">
                                            <div style="color: #6b7280; font-weight: 600; font-size: 0.8rem;">${mod.group}:</div>
                                            <div>
                                                ${mod.selected.map(option => {
                                                    // Handle both string and object formats
                                                    const optionObj = typeof option === 'string' ? {name: option} : option;
                                                    const priceText = optionObj.price ? 
                                                        (optionObj.price > 0 ? ` (+$${optionObj.price.toFixed(2)})` : 
                                                        ` (-$${Math.abs(optionObj.price).toFixed(2)})`) : '';
                                                    
                                                    return `<span style="background: #f3f4f6; padding: 2px 6px; border-radius: 4px; margin: 2px; display: inline-block; font-size: 0.8rem;">
                                                        ${optionObj.name}${priceText}
                                                    </span>`;
                                                }).join('')}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        ${item.modifications && item.modifications.length > 0 ? `
                            <div class="item-modifications">
                                <small style="color: #7c3aed; font-weight: 600;">Modifications:</small>
                                <div style="font-size: 0.8rem; color: #6b7280;">
                                    ${item.modifications.map(mod => `
                                        <span style="background: #f3f4f6; padding: 2px 6px; border-radius: 4px; margin: 2px; display: inline-block;">
                                            ${mod.name} ${mod.price > 0 ? `(+$${mod.price.toFixed(2)})` : mod.price < 0 ? `(-$${Math.abs(mod.price).toFixed(2)})` : ''}
                                        </span>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        ${item.specialRequests ? `
                            <div class="special-requests">
                                <small style="color: #059669; font-weight: 600;">Special Requests:</small>
                                <div style="font-size: 0.8rem; color: #6b7280; font-style: italic;">${item.specialRequests}</div>
                            </div>
                        ` : ''}
                        ${item.allergies && item.allergies.length > 0 ? `
                            <div class="allergy-alerts">
                                <small style="color: #dc2626; font-weight: 600;">⚠️ Allergies:</small>
                                <div style="font-size: 0.8rem; color: #dc2626; font-weight: 600;">
                                    ${item.allergies.join(', ')}
                                </div>
                            </div>
                        ` : ''}
                        <div class="quantity-controls">
                            <button class="qty-btn" onclick="updateQuantity('${item.id}', -1)">-</button>
                            <span class="qty-display">${item.quantity}</span>
                            <button class="qty-btn" onclick="updateQuantity('${item.id}', 1)">+</button>
                            <button class="qty-btn modify-btn" onclick="showModificationModal('${item.id}')" title="Modify item">⚙️</button>
                            <button class="qty-btn remove-item" onclick="removeFromCart('${item.id}')" title="Remove item">×</button>
                        </div>
                    </div>
                    <div class="item-total">$${((item.quantity * item.price) + (item.modifications ? item.modifications.reduce((sum, mod) => sum + (mod.price * item.quantity), 0) : 0)).toFixed(2)}</div>
                </div>
            `).join('');            // Calculate totals
            const subtotal = cart.reduce((sum, item) => {
                const itemTotal = item.quantity * item.price;
                const modificationsTotal = item.modifications ? 
                    item.modifications.reduce((modSum, mod) => modSum + (mod.price * item.quantity), 0) : 0;
                return sum + itemTotal + modificationsTotal;
            }, 0);
            const tax = subtotal * 0.085;
            const total = subtotal + tax;

            document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('tax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('total').textContent = `$${total.toFixed(2)}`;

            orderSummary.style.display = 'block';
            payButton.disabled = false;
            orderTotal = total;
        }        // Action functions
        function customizeItem(itemId) {
            // Find the menu item
            const item = menuItems.find(i => i.id === itemId);
            if (!item) {
                showNotification(`Item not found`, 'error');
                return;
            }
            
            // Check if item has modifiers
            if (!item.modifiers || item.modifiers.length === 0) {
                showNotification(`No modifiers available for ${item.name}`, 'info');
                return;
            }
            
            // Create a modal with modifier options
            const modal = document.createElement('div');
            modal.className = 'modal-overlay active';
            modal.id = 'modifierModal';
            
            let modalContent = `
                <div class="modal" style="max-width: 700px;">
                    <div class="modal-header">
                        <h3 class="modal-title">Customize ${item.name}</h3>
                        <button class="modal-close" onclick="closeModifierModal()">×</button>
                    </div>
                    <div class="modal-content">
                        <form id="itemModifiersForm">
            `;
              // Add modifier groups to the form
            item.modifiers.forEach((group, groupIndex) => {
                // Add required marker if applicable
                const requiredLabel = group.required ? '<span style="color: #dc2626; margin-left: 0.5rem;">*Required</span>' : '';
                
                modalContent += `
                    <div class="modification-section">
                        <h4 style="margin-bottom: 1rem; color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem;">
                            ${group.name}${requiredLabel}
                        </h4>
                `;
                
                if (group.type === 'single') {
                    // Radio buttons for single selection
                    modalContent += `<div class="radio-group" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 0.5rem;">`;
                    
                    // Process options
                    group.options.forEach((option, optionIndex) => {
                        // Handle both string and object formats for backward compatibility
                        const optionObj = typeof option === 'string' 
                            ? { name: option, price: 0, default: false } 
                            : option;
                        
                        // Format price display if there's a price adjustment
                        const priceDisplay = optionObj.price != 0 
                            ? (optionObj.price > 0 ? ` (+$${optionObj.price.toFixed(2)})` : ` (-$${Math.abs(optionObj.price).toFixed(2)})`)
                            : '';
                        
                        modalContent += `
                            <label class="radio-option" style="display: flex; align-items: center; padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 4px;">
                                <input type="radio" name="modifier_${groupIndex}" value="${JSON.stringify(optionObj).replace(/"/g, '&quot;')}" ${optionObj.default ? 'checked' : ''}>
                                <span style="margin-left: 0.5rem;">${optionObj.name}${priceDisplay}</span>
                            </label>
                        `;
                    });
                    modalContent += `</div>`;
                } else {
                    // Checkboxes for multi selection
                    modalContent += `<div class="checkbox-group" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 0.5rem;">`;
                    
                    group.options.forEach((option, optionIndex) => {
                        // Handle both string and object formats
                        const optionObj = typeof option === 'string' 
                            ? { name: option, price: 0, default: false } 
                            : option;
                        
                        // Format price display if there's a price adjustment
                        const priceDisplay = optionObj.price != 0 
                            ? (optionObj.price > 0 ? ` (+$${optionObj.price.toFixed(2)})` : ` (-$${Math.abs(optionObj.price).toFixed(2)})`)
                            : '';
                        
                        modalContent += `
                            <label class="checkbox-option" style="display: flex; align-items: center; padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 4px;">
                                <input type="checkbox" name="modifier_${groupIndex}_${optionIndex}" value="${JSON.stringify(optionObj).replace(/"/g, '&quot;')}" ${optionObj.default ? 'checked' : ''}>
                                <span style="margin-left: 0.5rem;">${optionObj.name}${priceDisplay}</span>
                            </label>
                        `;
                    });
                    modalContent += `</div>`;
                }
                
                modalContent += `</div>`;
            });
            
            modalContent += `
                        </form>
                    </div>
                    <div class="modal-actions" style="padding: 1rem; display: flex; justify-content: flex-end; gap: 1rem; border-top: 1px solid #e5e7eb;">
                        <button type="button" class="modal-btn secondary" onclick="closeModifierModal()">Cancel</button>
                        <button type="button" class="modal-btn primary" onclick="addToCartWithModifiers('${itemId}')">
                            Add to Order
                        </button>
                    </div>
                </div>
            `;
            
            modal.innerHTML = modalContent;
            document.body.appendChild(modal);
        }
        
        function closeModifierModal() {
            const modal = document.getElementById('modifierModal');
            if (modal) {
                document.body.removeChild(modal);
            }
        }
          function addToCartWithModifiers(itemId) {
            const item = menuItems.find(i => i.id === itemId);
            if (!item) return;
            
            // Check for required modifiers that haven't been selected
            const missingRequired = [];
            const form = document.getElementById('itemModifiersForm');
            
            item.modifiers.forEach((group, groupIndex) => {
                if (group.required) {
                    if (group.type === 'single') {
                        const selected = form.querySelector(`input[name="modifier_${groupIndex}"]:checked`);
                        if (!selected) {
                            missingRequired.push(group.name);
                        }
                    } else {
                        let hasSelection = false;
                        group.options.forEach((option, optionIndex) => {
                            const checkbox = form.querySelector(`input[name="modifier_${groupIndex}_${optionIndex}"]:checked`);
                            if (checkbox) hasSelection = true;
                        });
                        if (!hasSelection) {
                            missingRequired.push(group.name);
                        }
                    }
                }
            });
            
            // Show error if required modifiers are missing
            if (missingRequired.length > 0) {
                showNotification(`Please select required options for: ${missingRequired.join(', ')}`, 'warning');
                return;
            }
            
            // Calculate price adjustments
            let priceAdjustment = 0;
            
            // Collect selected modifiers
            const selectedModifiers = [];
            
            item.modifiers.forEach((group, groupIndex) => {
                const groupModifiers = {
                    group: group.name,
                    type: group.type,
                    selected: []
                };
                
                if (group.type === 'single') {
                    const selected = form.querySelector(`input[name="modifier_${groupIndex}"]:checked`);
                    if (selected) {
                        try {
                            const optionObj = JSON.parse(selected.value);
                            groupModifiers.selected.push(optionObj);
                            if (optionObj.price) {
                                priceAdjustment += parseFloat(optionObj.price);
                            }
                        } catch (e) {
                            // Fallback for old string format
                            groupModifiers.selected.push({name: selected.value, price: 0});
                        }
                    }
                } else {
                    group.options.forEach((option, optionIndex) => {
                        const checkbox = form.querySelector(`input[name="modifier_${groupIndex}_${optionIndex}"]:checked`);
                        if (checkbox) {
                            try {
                                const optionObj = JSON.parse(checkbox.value);
                                groupModifiers.selected.push(optionObj);
                                if (optionObj.price) {
                                    priceAdjustment += parseFloat(optionObj.price);
                                }
                            } catch (e) {
                                // Fallback for old string format
                                groupModifiers.selected.push({name: checkbox.value, price: 0});
                            }
                        }
                    });
                }
                  if (groupModifiers.selected.length > 0) {
                    selectedModifiers.push(groupModifiers);
                }
            });
            
            // Apply price adjustment to the item
            const adjustedPrice = item.price + priceAdjustment;
            
            // Add to cart with modifiers
            addToCart(itemId, item.name, adjustedPrice, selectedModifiers, priceAdjustment);
            closeModifierModal();
        }

        function showDetails(itemId) {
            showNotification(`Details for ${itemId} - Feature coming soon!`);
        }

        // Order Modification System
        let currentModificationItemId = null;

        function showModificationModal(itemId) {
            currentModificationItemId = itemId;
            const item = cart.find(i => i.id === itemId);
            if (!item) return;

            const modal = document.createElement('div');
            modal.className = 'modal-overlay active';
            modal.id = 'modificationModal';
            modal.innerHTML = `
                <div class="modal" style="max-width: 600px;">
                    <div class="modal-header">
                        <h3 class="modal-title">Modify ${item.name}</h3>
                        <button class="modal-close" onclick="closeModificationModal()">×</button>
                    </div>
                    <div class="modal-content">
                        <form id="modificationForm" onsubmit="saveModifications(event)">
                            <!-- Common Modifications -->
                            <div class="modification-section">
                                <h4 style="margin-bottom: 1rem; color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem;">🔧 Common Modifications</h4>
                                <div class="modification-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                                    <label class="modification-item">
                                        <input type="checkbox" name="modification" value="no-onions|No Onions|0"> No Onions
                                    </label>
                                    <label class="modification-item">
                                        <input type="checkbox" name="modification" value="extra-cheese|Extra Cheese|2.50"> Extra Cheese (+$2.50)
                                    </label>
                                    <label class="modification-item">
                                        <input type="checkbox" name="modification" value="no-tomatoes|No Tomatoes|0"> No Tomatoes
                                    </label>
                                    <label class="modification-item">
                                        <input type="checkbox" name="modification" value="extra-sauce|Extra Sauce|1.00"> Extra Sauce (+$1.00)
                                    </label>
                                    <label class="modification-item">
                                        <input type="checkbox" name="modification" value="no-pickles|No Pickles|0"> No Pickles
                                    </label>
                                    <label class="modification-item">
                                        <input type="checkbox" name="modification" value="extra-bacon|Extra Bacon|3.00"> Extra Bacon (+$3.00)
                                    </label>
                                    <label class="modification-item">
                                        <input type="checkbox" name="modification" value="light-salt|Light Salt|0"> Light Salt
                                    </label>
                                    <label class="modification-item">
                                        <input type="checkbox" name="modification" value="on-side|Sauce on Side|0"> Sauce on Side
                                    </label>
                                </div>
                            </div>

                            <!-- Cooking Preferences -->
                            <div class="modification-section" style="margin-top: 1.5rem;">
                                <h4 style="margin-bottom: 1rem; color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem;">🍳 Cooking Preferences</h4>
                                <div class="cooking-options" style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                    <label class="cooking-option">
                                        <input type="radio" name="cooking" value="rare|Rare|0"> Rare
                                    </label>
                                    <label class="cooking-option">
                                        <input type="radio" name="cooking" value="medium-rare|Medium Rare|0"> Medium Rare
                                    </label>
                                    <label class="cooking-option">
                                        <input type="radio" name="cooking" value="medium|Medium|0"> Medium
                                    </label>
                                    <label class="cooking-option">
                                        <input type="radio" name="cooking" value="medium-well|Medium Well|0"> Medium Well
                                    </label>
                                    <label class="cooking-option">
                                        <input type="radio" name="cooking" value="well-done|Well Done|0"> Well Done
                                    </label>
                                </div>
                            </div>

                            <!-- Allergies & Dietary -->
                            <div class="modification-section" style="margin-top: 1.5rem;">
                                <h4 style="margin-bottom: 1rem; color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem;">⚠️ Allergies & Dietary</h4>
                                <div class="allergy-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                                    <label class="allergy-item">
                                        <input type="checkbox" name="allergy" value="nuts"> Nuts
                                    </label>
                                    <label class="allergy-item">
                                        <input type="checkbox" name="allergy" value="dairy"> Dairy
                                    </label>
                                    <label class="allergy-item">
                                        <input type="checkbox" name="allergy" value="gluten"> Gluten
                                    </label>
                                    <label class="allergy-item">
                                        <input type="checkbox" name="allergy" value="shellfish"> Shellfish
                                    </label>
                                    <label class="allergy-item">
                                        <input type="checkbox" name="allergy" value="soy"> Soy
                                    </label>
                                    <label class="allergy-item">
                                        <input type="checkbox" name="allergy" value="eggs"> Eggs
                                    </label>
                                </div>
                            </div>

                            <!-- Special Requests -->
                            <div class="modification-section" style="margin-top: 1.5rem;">
                                <h4 style="margin-bottom: 1rem; color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem;">📝 Special Requests</h4>
                                <textarea 
                                    name="specialRequests" 
                                    placeholder="Enter any special cooking instructions or requests..."
                                    style="width: 100%; min-height: 80px; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 6px; font-family: inherit; resize: vertical;"
                                >${item.specialRequests || ''}</textarea>
                            </div>

                            <div class="modal-actions" style="margin-top: 2rem; display: flex; gap: 1rem;">
                                <button type="button" onclick="closeModificationModal()" class="modal-btn secondary">Cancel</button>
                                <button type="submit" class="modal-btn primary">Save Modifications</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Pre-populate existing modifications
            if (item.modifications && item.modifications.length > 0) {
                item.modifications.forEach(mod => {
                    const checkbox = modal.querySelector(`input[value="${mod.key}|${mod.name}|${mod.price}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }

            // Pre-populate existing allergies
            if (item.allergies && item.allergies.length > 0) {
                item.allergies.forEach(allergy => {
                    const checkbox = modal.querySelector(`input[value="${allergy}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }

            // Close on overlay click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModificationModal();
                }
            });
        }

        function closeModificationModal() {
            const modal = document.getElementById('modificationModal');
            if (modal) {
                modal.remove();
                currentModificationItemId = null;
            }
        }

        function saveModifications(event) {
            event.preventDefault();
            
            if (!currentModificationItemId) return;
            
            const item = cart.find(i => i.id === currentModificationItemId);
            if (!item) return;

            const formData = new FormData(event.target);
            
            // Get modifications
            const modifications = [];
            const modificationInputs = formData.getAll('modification');
            modificationInputs.forEach(mod => {
                const [key, name, price] = mod.split('|');
                modifications.push({
                    key: key,
                    name: name,
                    price: parseFloat(price)
                });
            });

            // Get cooking preference
            const cooking = formData.get('cooking');
            if (cooking) {
                const [key, name, price] = cooking.split('|');
                modifications.push({
                    key: key,
                    name: name,
                    price: parseFloat(price)
                });
            }

            // Get allergies
            const allergies = formData.getAll('allergy');

            // Get special requests
            const specialRequests = formData.get('specialRequests');

            // Update item
            item.modifications = modifications;
            item.allergies = allergies;
            item.specialRequests = specialRequests;

            updateCartDisplay();
            closeModificationModal();

            const modCount = modifications.length + allergies.length + (specialRequests ? 1 : 0);
            showNotification(`${item.name} updated with ${modCount} modification${modCount !== 1 ? 's' : ''}!`, 'success');
        }function processPayment() {
            if (cart.length === 0) return;
            
            showNotification(`Processing payment of $${orderTotal.toFixed(2)}...`);
            
            // Add order to kitchen when payment is processed
            const newOrder = {
                id: `#${String(Math.floor(Math.random() * 1000)).padStart(3, '0')}`,
                table: selectedTable ? `T${selectedTable.id}` : 'Walk-in',
                items: cart.map(item => ({...item})),
                status: 'preparing',
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                totalTime: '15 min'
            };
            
            setTimeout(() => {
                kitchenOrders.unshift(newOrder);
                showNotification('Payment successful! Order sent to kitchen.', 'success');                // Update table status to occupied if table was selected
                if (selectedTable && selectedTable.status === 'available') {
                    selectedTable.status = 'occupied';
                    selectedTable.guests = 1; // You could prompt for actual guest count
                    selectedTable.server = currentServerName || 'Current User';
                    selectedTable.orderTime = newOrder.time;
                    renderTables();
                    saveTableStatuses();
                }
                
                clearCart();
                clearTableSelection();
                
                if (currentView === 'kitchen') {
                    updateKitchenDisplay();
                }
            }, 2000);
        }

        function printCheck() {
            if (cart.length === 0) {
                showNotification('No items to print!', 'warning');
                return;
            }
            showNotification('Printing check...', 'info');
        }        function editCheck() {
            if (!selectedTable) {
                showNotification('Please select a table first!', 'warning');
                return;
            }
            
            if (cart.length === 0) {
                showNotification('No items to edit!', 'warning');
                return;
            }
            
            // Redirect to the edit check interface with table information
            const tableId = selectedTable.id;
            window.location.href = `edit-check.html?table=${tableId}`;
        }

        function voidCheck() {
            if (cart.length === 0) {
                showNotification('No items to void!', 'warning');
                return;
            }
            
            if (confirm('Are you sure you want to void this check?')) {
                clearCart();
                showNotification('Check voided successfully!', 'warning');
            }
        }

        function clearCart() {
            cart = [];
            orderTotal = 0;
            updateCartDisplay();
        }        function logout() {
            const currentUser = getUserInfo();
            const superAdminAccess = localStorage.getItem('superAdminPOSAccess');
            
            if (currentUser && currentUser.role === 'super_admin' && superAdminAccess === 'true') {
                // Super admin logout - give option to return to dashboard or fully logout
                const choice = confirm('Super Admin Logout Options:\n\n' +
                    'OK = Return to Super Admin Dashboard\n' +
                    'Cancel = Full Logout (return to login)');
                
                if (choice) {
                    // Return to super admin dashboard
                    localStorage.removeItem('superAdminPOSAccess');
                    window.location.href = 'super-admin-dashboard.html';
                } else {
                    // Full logout
                    localStorage.removeItem('currentUser');
                    localStorage.removeItem('currentBusinessContext');
                    localStorage.removeItem('propertyType');
                    localStorage.removeItem('propertyName');
                    localStorage.removeItem('firstLogin');
                    localStorage.removeItem('superAdminPOSAccess');
                    
                    window.location.href = 'login.html';
                }
            } else {
                // Regular user logout
                if (confirm('Are you sure you want to logout?')) {
                    // Clear user session data
                    localStorage.removeItem('currentUser');
                    localStorage.removeItem('userSession');
                    localStorage.removeItem('isLoggedIn');
                    localStorage.removeItem('superAdminPOSAccess');
                    
                    // Redirect to login page
                    window.location.href = 'login.html';
                }
            }        }

        // Settings functions
        function openGeneralSettings() {
            const currentUser = getUserInfo();
            
            // Super admin always has access to settings
            if (currentUser && currentUser.role === 'super_admin') {
                // Show super admin options with enhanced styling
                const modal = document.createElement('div');
                modal.className = 'modal-overlay active';
                modal.id = 'superAdminSettingsModal';
                modal.innerHTML = `
                    <div class="modal" style="max-width: 600px;">
                        <div class="modal-header" style="background: linear-gradient(135deg, #ffd700, #ffed4e); color: #000; border-radius: 8px 8px 0 0;">
                            <h3 class="modal-title" style="display: flex; align-items: center; gap: 10px;">
                                👑 Super Admin General Settings Access
                            </h3>
                            <button class="modal-close" onclick="closeSuperAdminSettingsModal()" style="background: rgba(0,0,0,0.1); color: #000;">×</button>
                        </div>
                        <div class="modal-content" style="padding: 2rem;">
                            <p style="text-align: center; margin-bottom: 2rem; color: #374151; font-size: 1.1rem;">
                                Choose your general settings access level:
                            </p>
                            
                            <div style="display: grid; gap: 1rem;">
                                <button onclick="navigateToSuperAdminDashboard()" 
                                        style="background: linear-gradient(135deg, #ffd700, #ffed4e); color: #000; border: 3px solid #000; padding: 1.5rem; border-radius: 12px; cursor: pointer; font-weight: 700; font-family: 'Courier New', monospace; font-size: 16px; transition: all 0.3s ease;">
                                    👑 Super Admin Dashboard
                                    <div style="font-size: 14px; font-weight: normal; margin-top: 8px; opacity: 0.8;">
                                        Global system management and oversight
                                    </div>
                                </button>
                                
                                <button onclick="navigateToGeneralSettings()" 
                                        style="background: linear-gradient(135deg, #10b981, #059669); color: white; border: 3px solid #000; padding: 1.5rem; border-radius: 12px; cursor: pointer; font-weight: 700; font-family: 'Courier New', monospace; font-size: 16px; transition: all 0.3s ease;">
                                    ⚙️ General Settings
                                    <div style="font-size: 14px; font-weight: normal; margin-top: 8px; opacity: 0.9;">
                                        POS system and operational settings
                                    </div>
                                </button>
                                
                                <button onclick="closeSuperAdminSettingsModal()" 
                                        style="background: #f3f4f6; color: #374151; border: 2px solid #d1d5db; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: 600; font-family: 'Courier New', monospace;">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                return;
            }
            
            if (!hasPermission('settings')) {
                showNotification('You do not have permission to access settings!', 'warning');
                return;
            }
            
            // Navigate to general settings page
            window.location.href = 'settings.html';
        }

        function openBusinessSettings() {
            const currentUser = getUserInfo();
            
            // Super admin always has access to business settings
            if (currentUser && currentUser.role === 'super_admin') {
                // Show super admin options with enhanced styling
                const modal = document.createElement('div');
                modal.className = 'modal-overlay active';
                modal.id = 'superAdminBusinessSettingsModal';
                modal.innerHTML = `
                    <div class="modal" style="max-width: 600px;">
                        <div class="modal-header" style="background: linear-gradient(135deg, #ffd700, #ffed4e); color: #000; border-radius: 8px 8px 0 0;">
                            <h3 class="modal-title" style="display: flex; align-items: center; gap: 10px;">
                                👑 Super Admin Business Settings Access
                            </h3>
                            <button class="modal-close" onclick="closeSuperAdminBusinessSettingsModal()" style="background: rgba(0,0,0,0.1); color: #000;">×</button>
                        </div>
                        <div class="modal-content" style="padding: 2rem;">
                            <p style="text-align: center; margin-bottom: 2rem; color: #374151; font-size: 1.1rem;">
                                Choose your business settings access level:
                            </p>
                            
                            <div style="display: grid; gap: 1rem;">
                                <button onclick="navigateToSuperAdminDashboard()" 
                                        style="background: linear-gradient(135deg, #ffd700, #ffed4e); color: #000; border: 3px solid #000; padding: 1.5rem; border-radius: 12px; cursor: pointer; font-weight: 700; font-family: 'Courier New', monospace; font-size: 16px; transition: all 0.3s ease;">
                                    👑 Super Admin Dashboard
                                    <div style="font-size: 14px; font-weight: normal; margin-top: 8px; opacity: 0.8;">
                                        Global system management and oversight
                                    </div>
                                </button>
                                
                                <button onclick="navigateToBusinessSettings()" 
                                        style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; border: 3px solid #000; padding: 1.5rem; border-radius: 12px; cursor: pointer; font-weight: 700; font-family: 'Courier New', monospace; font-size: 16px; transition: all 0.3s ease;">
                                    🏢 Business Settings
                                    <div style="font-size: 14px; font-weight: normal; margin-top: 8px; opacity: 0.9;">
                                        Current business context configuration
                                    </div>
                                </button>
                                
                                <button onclick="closeSuperAdminBusinessSettingsModal()" 
                                        style="background: #f3f4f6; color: #374151; border: 2px solid #d1d5db; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: 600; font-family: 'Courier New', monospace;">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                return;
            }
            
            if (!hasPermission('settings')) {
                showNotification('You do not have permission to access business settings!', 'warning');
                return;
            }
            
            // Navigate to business settings page
            window.location.href = 'business-settings.html';
        }

// Settings function (LEGACY - keeping for compatibility)
        function openSettings() {
            const currentUser = getUserInfo();
            
            // Super admin always has access to settings
            if (currentUser && currentUser.role === 'super_admin') {
                // Show super admin options with enhanced styling
                const modal = document.createElement('div');
                modal.className = 'modal-overlay active';
                modal.id = 'superAdminSettingsModal';
                modal.innerHTML = `
                    <div class="modal" style="max-width: 600px;">
                        <div class="modal-header" style="background: linear-gradient(135deg, #ffd700, #ffed4e); color: #000; border-radius: 8px 8px 0 0;">
                            <h3 class="modal-title" style="display: flex; align-items: center; gap: 10px;">
                                👑 Super Admin Settings Access
                            </h3>
                            <button class="modal-close" onclick="closeSuperAdminSettingsModal()" style="background: rgba(0,0,0,0.1); color: #000;">×</button>
                        </div>
                        <div class="modal-content" style="padding: 2rem;">
                            <p style="text-align: center; margin-bottom: 2rem; color: #374151; font-size: 1.1rem;">
                                Choose your settings access level:
                            </p>
                            
                            <div style="display: grid; gap: 1rem;">
                                <button onclick="navigateToSuperAdminDashboard()" 
                                        style="background: linear-gradient(135deg, #ffd700, #ffed4e); color: #000; border: 3px solid #000; padding: 1.5rem; border-radius: 12px; cursor: pointer; font-weight: 700; font-family: 'Courier New', monospace; font-size: 16px; transition: all 0.3s ease;">
                                    👑 Super Admin Dashboard
                                    <div style="font-size: 14px; font-weight: normal; margin-top: 8px; opacity: 0.8;">
                                        Global system management and oversight
                                    </div>
                                </button>
                                
                                <button onclick="navigateToBusinessSettings()" 
                                        style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; border: 3px solid #000; padding: 1.5rem; border-radius: 12px; cursor: pointer; font-weight: 700; font-family: 'Courier New', monospace; font-size: 16px; transition: all 0.3s ease;">
                                    🏢 Business Settings
                                    <div style="font-size: 14px; font-weight: normal; margin-top: 8px; opacity: 0.9;">
                                        Current business context configuration
                                    </div>
                                </button>
                                
                                <button onclick="closeSuperAdminSettingsModal()" 
                                        style="background: #f3f4f6; color: #374151; border: 2px solid #d1d5db; padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: 600; font-family: 'Courier New', monospace;">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                return;
            }
            
            if (!hasPermission('settings')) {
                showNotification('You do not have permission to access settings!', 'warning');
                return;
            }
            
            // Check if settings.html exists, otherwise show settings modal
            window.location.href = 'business-settings.html';
        }
          function closeSuperAdminSettingsModal() {
            const modal = document.getElementById('superAdminSettingsModal');
            if (modal) {
                modal.remove();
            }
        }

        function closeSuperAdminBusinessSettingsModal() {
            const modal = document.getElementById('superAdminBusinessSettingsModal');
            if (modal) {
                modal.remove();
            }
        }

        function navigateToGeneralSettings() {
            closeSuperAdminSettingsModal();
            window.location.href = 'settings.html';
        }
        
        function navigateToSuperAdminDashboard() {
            // Clear POS access flag but maintain user session
            localStorage.removeItem('superAdminPOSAccess');
            window.location.href = 'super-admin-dashboard.html';
        }
          function navigateToBusinessSettings() {
            // Close any open modals first
            closeSuperAdminSettingsModal();
            closeSuperAdminBusinessSettingsModal();
            window.location.href = 'business-settings.html';
        }
        
        function returnToSuperAdminDashboard() {
            // Clear POS access flag but maintain user session
            localStorage.removeItem('superAdminPOSAccess');
            window.location.href = 'super-admin-dashboard.html';
        }
          function showSuperAdminDashboardButton() {
            const dashboardBtn = document.getElementById('superAdminDashboardBtn');
            if (dashboardBtn) {
                dashboardBtn.style.display = 'block';
            }
        }
        
        function showSuperAdminWelcomeNotification() {
            // Create a special notification for super admin access
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: linear-gradient(135deg, #ffd700, #ffed4e);
                color: #000;
                padding: 1.5rem 2rem;
                border-radius: 12px;
                box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
                z-index: 10000;
                font-weight: 600;
                max-width: 350px;
                border: 3px solid #000;
                font-family: 'Courier New', monospace;
            `;
            
            const businessContext = localStorage.getItem('currentBusinessContext');
            let contextInfo = 'Global Access Mode';
            
            if (businessContext) {
                try {
                    const context = JSON.parse(businessContext);
                    contextInfo = `Business: ${context.companyName || 'Unknown'}`;
                } catch (error) {
                    contextInfo = 'Business Context Active';
                }
            }
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                    <span style="font-size: 1.5rem;">👑</span>
                    <strong>Super Admin POS Access</strong>
                </div>
                <div style="font-size: 0.9rem; opacity: 0.8;">
                    ${contextInfo}
                </div>
                <div style="font-size: 0.8rem; margin-top: 8px; opacity: 0.7;">
                    You have full access to all POS functions
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 5 seconds with fade out
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.5s ease forwards';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 500);
            }, 5000);
        }

        // Enhanced user management functions
        function getUserInfo() {
            try {
                const currentUser = localStorage.getItem('currentUser');
                return currentUser ? JSON.parse(currentUser) : null;
            } catch (error) {
                console.error('Error getting user info:', error);
                return null;
            }
        }

        function updateUserSession(updates) {
            try {
                const currentUser = localStorage.getItem('currentUser');
                if (currentUser) {
                    const user = JSON.parse(currentUser);
                    const updatedUser = { ...user, ...updates };
                    localStorage.setItem('currentUser', JSON.stringify(updatedUser));
                    updateHeaderWithUserInfo(updatedUser);
                    return true;
                }
            } catch (error) {
                console.error('Error updating user session:', error);
            }
            return false;
        }

        // Business account management
        function getBusinessInfo() {
            const user = getUserInfo();
            if (user && user.businessId) {
                const businessData = localStorage.getItem(`business_${user.businessId}`);
                try {
                    return businessData ? JSON.parse(businessData) : null;
                } catch (error) {
                    console.error('Error getting business info:', error);
                    return null;
                }
            }
            return null;
        }

        function updateBusinessInfo(updates) {
            const user = getUserInfo();
            if (user && user.businessId) {
                try {
                    const currentBusiness = getBusinessInfo() || {};
                    const updatedBusiness = { ...currentBusiness, ...updates };
                    localStorage.setItem(`business_${user.businessId}`, JSON.stringify(updatedBusiness));
                    
                    // Update user session with business name if changed
                    if (updates.name || updates.businessName) {
                        updateUserSession({ businessName: updates.name || updates.businessName });
                    }
                    
                    return true;
                } catch (error) {
                    console.error('Error updating business info:', error);
                }
            }
            return false;
        }        // Authentication Functions
        function checkAuthentication() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const currentUser = localStorage.getItem('currentUser');
            const superAdminAccess = localStorage.getItem('superAdminPOSAccess');
            
            // Allow super admin access even without regular login
            if (superAdminAccess === 'true') {
                console.log('🔑 Super Admin POS access detected');
                return true;
            }
            
            if (!isLoggedIn || !currentUser) {
                // Redirect to login page if not authenticated
                redirectToLogin();
                return false;
            }
            
            // Validate user session
            try {
                const user = JSON.parse(currentUser);
                if (!user.id || !user.email) {
                    console.warn('Invalid user data, redirecting to login');
                    redirectToLogin();
                    return false;
                }
                return true;
            } catch (error) {
                console.error('Error parsing user data:', error);
                redirectToLogin();
                return false;
            }
        }

        function redirectToLogin() {
            // Clear any invalid session data
            localStorage.removeItem('currentUser');
            localStorage.removeItem('userSession');
            localStorage.removeItem('isLoggedIn');
            
            // Check if login.html exists, otherwise use index.html
            window.location.href = 'login.html';
        }        function loadUserAccount() {
            try {
                const currentUser = localStorage.getItem('currentUser');
                const superAdminAccess = localStorage.getItem('superAdminPOSAccess');
                
                if (currentUser) {
                    const user = JSON.parse(currentUser);
                    
                    // If super admin is accessing POS, ensure we have the super admin flag
                    if (superAdminAccess === 'true' && user.role === 'super_admin') {
                        console.log('🔑 Loading super admin POS access');
                        
                        // Check if there's a business context for the super admin
                        const businessContext = localStorage.getItem('currentBusinessContext');
                        if (businessContext) {
                            try {
                                const context = JSON.parse(businessContext);
                                console.log(`🏢 Super admin accessing business context: ${context.companyName}`);
                            } catch (error) {
                                console.error('Error parsing business context:', error);
                            }
                        }
                    }
                    
                    updateHeaderWithUserInfo(user);
                    
                    // Load business settings if available
                    loadBusinessSettings(user);
                } else {
                    console.warn('No user data found, redirecting to login');
                    redirectToLogin();
                }
            } catch (error) {
                console.error('Error loading user account:', error);
                redirectToLogin();
            }
        }function updateHeaderWithUserInfo(user) {
            const accountInfo = document.querySelector('.account-info');
            const hotelName = document.querySelector('.hotel-name');
            
            if (accountInfo && user) {
                // Update account info with real user data
                const displayName = user.firstName && user.lastName 
                    ? `${user.firstName} ${user.lastName}` 
                    : user.name || user.fullName || 'User';
                let displayRole = user.role || user.position || 'Staff';
                  // Check for super admin status
                if (user.role === 'super_admin' && user.accessLevel === 'global') {
                    displayRole = '👑 Super Admin';
                    accountInfo.style.background = 'linear-gradient(135deg, #ffd700, #ffed4e)';
                    accountInfo.style.color = '#000';
                    accountInfo.style.padding = '5px 10px';
                    accountInfo.style.borderRadius = '15px';
                    accountInfo.style.fontWeight = 'bold';
                    accountInfo.style.boxShadow = '0 3px 10px rgba(255, 215, 0, 0.3)';
                    
                    // Add crown animation
                    accountInfo.style.animation = 'crownGlow 2s ease-in-out infinite alternate';
                    
                    // Show super admin dashboard button
                    showSuperAdminDashboardButton();
                    
                    // Add the animation if it doesn't exist
                    if (!document.getElementById('superAdminStyle')) {
                        const style = document.createElement('style');
                        style.id = 'superAdminStyle';
                        style.textContent = `
                            @keyframes crownGlow {
                                from { box-shadow: 0 3px 10px rgba(255, 215, 0, 0.3); }
                                to { box-shadow: 0 6px 20px rgba(255, 215, 0, 0.6); }
                            }
                        `;
                        document.head.appendChild(style);
                    }
                } else {
                    // Reset styles for normal users
                    accountInfo.style.background = '';
                    accountInfo.style.color = '';
                    accountInfo.style.padding = '';
                    accountInfo.style.borderRadius = '';
                    accountInfo.style.fontWeight = '';
                    accountInfo.style.boxShadow = '';
                    accountInfo.style.animation = '';
                }
                
                accountInfo.textContent = `${displayName} (${displayRole})`;
                
                // Update business name if available
                if (hotelName) {
                    let businessName = user.businessName || user.companyName || user.restaurantName;
                    
                    // Check for business context or super admin global access
                    if (user.role === 'super_admin') {
                        const businessContext = localStorage.getItem('currentBusinessContext');
                        if (businessContext) {
                            try {
                                const context = JSON.parse(businessContext);
                                businessName = context.companyName || 'Business Context';
                            } catch (error) {
                                console.error('Error parsing business context:', error);
                                businessName = 'Global Access - All Properties';
                            }
                        } else {
                            businessName = 'Global Access - All Properties';
                        }
                    }
                    
                    hotelName.textContent = businessName || 'Restaurant POS';
                }
                
                // Update server name in orders
                currentServerName = displayName;
            }
        }

        function loadBusinessSettings(user) {
            // Load business-specific settings
            const businessId = user.businessId || user.companyId;
            if (businessId) {
                const businessData = localStorage.getItem(`business_${businessId}`);
                if (businessData) {
                    try {
                        const business = JSON.parse(businessData);
                        // Apply business settings like tax rates, currency, etc.
                        if (business.taxRate) {
                            // Update tax calculation if needed
                            window.businessTaxRate = business.taxRate;
                        }
                        if (business.theme) {
                            // Apply business theme/branding
                            applyBusinessTheme(business.theme);
                        }
                    } catch (error) {
                        console.error('Error loading business settings:', error);
                    }
                }
            }
        }

        function applyBusinessTheme(theme) {
            // Apply business-specific theme/branding
            if (theme.primaryColor) {
                document.documentElement.style.setProperty('--primary-color', theme.primaryColor);
            }
            if (theme.logo) {
                // Update logo if there's a logo element
                const logoElement = document.querySelector('.business-logo');
                if (logoElement) {
                    logoElement.src = theme.logo;
                }
            }
        }// Global variable for current server name
        let currentServerName = 'Current User';

        // Role-based permissions
        const ROLES = {
            OWNER: 'owner',
            MANAGER: 'manager',
            SERVER: 'server',
            CASHIER: 'cashier',
            KITCHEN: 'kitchen'
        };

        const PERMISSIONS = {
            [ROLES.OWNER]: ['all'],
            [ROLES.MANAGER]: ['tables', 'menu', 'kitchen', 'orders', 'reports', 'settings'],
            [ROLES.SERVER]: ['tables', 'menu', 'orders'],
            [ROLES.CASHIER]: ['menu', 'orders'],
            [ROLES.KITCHEN]: ['kitchen', 'orders']
        };        function hasPermission(permission) {
            // DEVELOPER MODE: Grant all permissions
            return true;
            
            // Original permission check (commented out for development)
            /*
            try {
                const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                const userRole = (currentUser.role || currentUser.position || 'server').toLowerCase();
                const userPermissions = PERMISSIONS[userRole] || PERMISSIONS[ROLES.SERVER];
                
                return userPermissions.includes('all') || userPermissions.includes(permission);
            } catch (error) {
                console.error('Error checking permissions:', error);
                return true; // Default to allow if error
            }
            */
        }        function initializeRoleBasedUI() {
            // DEVELOPER MODE: Show all tabs and features
            const tablesTab = document.querySelector('.tab-button[onclick="switchTab(\'tables\')"]');
            const kitchenTab = document.querySelector('.tab-button[onclick="switchTab(\'kitchen\')"]');
            const settingsBtn = document.querySelector('.header-btn[onclick*="settings"]');
            
            // Ensure all tabs are visible in development mode
            if (tablesTab) tablesTab.style.display = 'block';
            if (kitchenTab) kitchenTab.style.display = 'block';
            if (settingsBtn) settingsBtn.style.display = 'block';
            
            // Original role-based logic (commented out for development)
            /*
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const userRole = (currentUser.role || currentUser.position || 'server').toLowerCase();
            
            // Hide/show tabs based on role
            if (!hasPermission('tables') && tablesTab) {
                tablesTab.style.display = 'none';
            }
            
            if (!hasPermission('kitchen') && kitchenTab) {
                kitchenTab.style.display = 'none';
            }
            
            if (!hasPermission('settings') && settingsBtn) {
                settingsBtn.style.display = 'none';
            }
            
            // Restrict certain actions based on role
            if (userRole === ROLES.KITCHEN) {
                // Kitchen staff should start on kitchen view
                setTimeout(() => {
                    if (kitchenTab) kitchenTab.click();
                }, 100);
            }
            */
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#10b981' : type === 'warning' ? '#f59e0b' : type === 'error' ? '#ef4444' : '#3b82f6'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10000;
                font-weight: 500;
                max-width: 300px;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);        }        // Tables Management
        let tables = [];        // Initialize tables data
        function initializeTables() {
            console.log('Initializing tables...');
            
            const savedPlan = localStorage.getItem('floorPlan');
            console.log('Saved floor plan raw data:', savedPlan);
            
            if (savedPlan) {
                try {
                    const floorPlanTables = JSON.parse(savedPlan);
                    console.log('Found floor plan data:', floorPlanTables);
                    console.log('Floor plan array length:', floorPlanTables.length);
                      if (Array.isArray(floorPlanTables) && floorPlanTables.length > 0) {
                        tables = floorPlanTables.map(tableData => {
                            console.log('Processing table data:', tableData);
                            // Extract table number from id (remove any prefixes)
                            let tableNumber = tableData.id;
                            if (typeof tableNumber === 'string') {
                                // Extract number from strings like "table-1" or "draggable-table-1"
                                const match = tableNumber.match(/(\d+)$/);
                                tableNumber = match ? parseInt(match[1]) : 1;
                            }
                              // Create table object that preserves floor plan data while adding POS functionality
                            const processedTable = {
                                id: tableNumber,
                                capacity: parseInt(tableData.capacity) || 2,
                                status: 'available',
                                guests: 0,
                                server: '',
                                orderTime: null,
                                reservedBy: '',
                                tags: [], // Add tags array
                                seatedTime: null, // Add seated time tracking
                                lastActivity: null, // Track last activity
                                // Include all original floor plan properties for positioning
                                left: tableData.left,
                                top: tableData.top,
                                width: tableData.width,
                                height: tableData.height,
                                shapeType: tableData.shapeType || 'square',
                                name: tableData.name,
                                rotationAngle: tableData.rotationAngle || 0
                            };
                              console.log('Processed table:', processedTable);
                            return processedTable;
                        });
                        
                        // Sort tables by ID for consistent display
                        tables.sort((a, b) => a.id - b.id);
                        
                        console.log('Processed tables:', tables);
                    } else {
                        console.warn('Invalid floor plan data format');
                        tables = [];
                    }
                } catch (error) {
                    console.error('Error parsing floor plan data:', error);
                    tables = [];
                }
                
                // Load saved table statuses if they exist
                const savedStatuses = localStorage.getItem('tableStatuses');
                if (savedStatuses) {
                    try {
                        const tableStatuses = JSON.parse(savedStatuses);
                        console.log('Loading saved table statuses:', tableStatuses);
                        
                        tables.forEach(table => {
                            if (tableStatuses[table.id]) {
                                const savedStatus = tableStatuses[table.id];                                table.status = savedStatus.status || 'available';
                                table.guests = savedStatus.guests || 0;
                                table.server = savedStatus.server || '';                                table.orderTime = savedStatus.orderTime || null;
                                table.reservedBy = savedStatus.reservedBy || '';
                                table.tags = savedStatus.tags || []; // Load saved tags
                                table.seatedTime = savedStatus.seatedTime || null; // Load seated time
                                table.lastActivity = savedStatus.lastActivity || null; // Load last activity
                            }
                        });
                    } catch (error) {
                        console.error('Error loading table statuses:', error);
                    }
                }
            }            if (tables.length === 0) {
                // Fallback to default configuration if no floor plan exists
                console.log('No floor plan found, using default tables (no floor plan layout)');
                tables = [
                    { id: 1, capacity: 4, status: 'available', guests: 0, server: '', orderTime: null, reservedBy: '', tags: [], seatedTime: null, lastActivity: null },
                    { id: 2, capacity: 2, status: 'available', guests: 0, server: '', orderTime: null, reservedBy: '', tags: [], seatedTime: null, lastActivity: null },
                    { id: 3, capacity: 6, status: 'available', guests: 0, server: '', orderTime: null, reservedBy: '', tags: [], seatedTime: null, lastActivity: null },
                    { id: 4, capacity: 4, status: 'available', guests: 0, server: '', orderTime: null, reservedBy: '', tags: [], seatedTime: null, lastActivity: null }
                ];
                console.log('Default tables created (no position data) - will show list view');
            }
            
            console.log(`Initialized ${tables.length} tables`);
            renderTables();
        }        // Save current table statuses to localStorage
        function saveTableStatuses() {
            const tableStatuses = {};
            tables.forEach(table => {
                tableStatuses[table.id] = {
                    status: table.status,
                    guests: table.guests,
                    server: table.server,
                    orderTime: table.orderTime,
                    reservedBy: table.reservedBy,
                    tags: table.tags || [], // Save tags
                    seatedTime: table.seatedTime || null, // Save seated time
                    lastActivity: table.lastActivity || null // Save last activity
                };
            });
            localStorage.setItem('tableStatuses', JSON.stringify(tableStatuses));
        }// Render tables grid
        function renderTables() {
            console.log('renderTables() called');
            const floorPlanCanvas = document.getElementById('floorPlanCanvas');
            
            if (!floorPlanCanvas) {
                console.error('Floor plan canvas not found');
                return;
            }
            
            console.log('Tables array length:', tables.length);
            console.log('Tables data:', tables);
              // Clear existing tables
            floorPlanCanvas.innerHTML = '';            // Check if we have floor plan data with positions
            // Check for direct properties from floor plan editor
            console.log('Tables before position check:', tables);
            console.log('Tables array structure:', tables.map(t => ({ id: t.id, left: t.left, hasLeft: !!t.left })));
            const hasFloorPlanPositions = tables.some(table => table.left);
            console.log('Has floor plan positions:', hasFloorPlanPositions);
            
            if (hasFloorPlanPositions) {
                console.log('Rendering visual floor plan with', tables.length, 'tables');
                // Render visual floor plan
                renderVisualFloorPlan();
            } else {
                console.log('No floor plan positions found, showing placeholder');
                // Show message if no floor plan layout exists
                floorPlanCanvas.innerHTML = `
                    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: #9ca3af; text-align: center; padding: 2rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">🏗️</div>
                        <h3 style="margin-bottom: 0.5rem; color: #374151;">No Floor Plan Layout Found</h3>
                        <p style="margin-bottom: 1rem; color: #6b7280;">Create your restaurant layout using the floor plan editor to see tables positioned visually</p>                        <div style="display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center;">
                            <button onclick="window.location.href='floor-plan-editor.html'" style="background: #3b82f6; color: white; border: 2px solid #000; padding: 0.75rem 1.5rem; font-family: 'Courier New', monospace; cursor: pointer; border-radius: 4px; font-weight: bold;">
                                Open Floor Plan Editor
                            </button>
                            <button onclick="refreshFloorPlan()" style="background: #059669; color: white; border: 2px solid #000; padding: 0.75rem 1.5rem; font-family: 'Courier New', monospace; cursor: pointer; border-radius: 4px; font-weight: bold;">
                                Refresh Layout
                            </button>                            <button onclick="createSampleFloorPlanData()" style="background: #dc2626; color: white; border: 2px solid #000; padding: 0.75rem 1.5rem; font-family: 'Courier New', monospace; cursor: pointer; border-radius: 4px; font-weight: bold;">
                                Create Sample Data
                            </button>
                            <button onclick="testDirectTableInjection()" style="background: #f59e0b; color: white; border: 2px solid #000; padding: 0.75rem 1.5rem; font-family: 'Courier New', monospace; cursor: pointer; border-radius: 4px; font-weight: bold;">
                                Test Direct Injection
                            </button>
                            <button onclick="emergencyDebug()" style="background: #ef4444; color: white; border: 2px solid #000; padding: 0.75rem 1.5rem; font-family: 'Courier New', monospace; cursor: pointer; border-radius: 4px; font-weight: bold;">
                                Emergency Debug
                            </button>
                            <button onclick="window.open('debug-floor-plan.html', '_blank')" style="background: #7c3aed; color: white; border: 2px solid #000; padding: 0.75rem 1.5rem; font-family: 'Courier New', monospace; cursor: pointer; border-radius: 4px; font-weight: bold;">
                                Debug Tool
                            </button>
                        </div>
                        ${tables.length > 0 ? `
                            <div style="margin-top: 2rem; padding: 1rem; background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 8px; max-width: 400px;">
                                <h4 style="margin-bottom: 0.5rem; color: #374151;">Default Tables Available:</h4>
                                <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 1rem;">Use the menu to access table functions</p>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; font-size: 0.875rem;">
                                    ${tables.map(table => `
                                        <div style="padding: 0.5rem; background: white; border: 1px solid #d1d5db; border-radius: 4px; text-align: center;">
                                            <strong>Table ${table.id}</strong><br>
                                            <span style="color: #6b7280;">Cap: ${table.capacity}</span><br>
                                            <span style="color: ${getStatusColor(table.status)}; font-weight: bold;">${table.status}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }        }function renderVisualFloorPlan() {
            console.log('=== renderVisualFloorPlan() START ===');
            const floorPlanCanvas = document.getElementById('floorPlanCanvas');
            
            if (!floorPlanCanvas) {
                console.error('Floor plan canvas not found');
                return;
            }
            
            console.log('Floor plan canvas found:', floorPlanCanvas);
            console.log('Canvas current innerHTML:', floorPlanCanvas.innerHTML);
            console.log('Canvas current children count:', floorPlanCanvas.children.length);
            console.log('Tables to render:', tables.length);
            
            tables.forEach((table, index) => {
                console.log(`Processing table ${index + 1}:`, table);
                
                if (!table.left) {
                    console.warn(`Table ${table.id} has no position data - skipping`);
                    return;
                }
                
                console.log(`Table ${table.id} has position data: left=${table.left}, top=${table.top}`);
                
                try {
                    const tableElement = document.createElement('div');
                    tableElement.className = `floor-plan-table ${table.status} ${table.shapeType || 'square'}`;
                    tableElement.id = `floor-table-${table.id}`;
                    
                    console.log(`Created element with className: ${tableElement.className}`);
                    console.log(`Created element with id: ${tableElement.id}`);
                    
                    // Ensure position values are properly formatted
                    const left = typeof table.left === 'string' ? table.left : `${table.left}px`;
                    const top = typeof table.top === 'string' ? table.top : `${table.top}px`;
                    const width = typeof table.width === 'string' ? table.width : `${table.width}px`;
                    const height = typeof table.height === 'string' ? table.height : `${table.height}px`;
                    
                    console.log(`Setting styles: left=${left}, top=${top}, width=${width}, height=${height}`);
                    
                    tableElement.style.left = left;
                    tableElement.style.top = top;
                    tableElement.style.width = width;
                    tableElement.style.height = height;
                    
                    // Apply rotation if present
                    if (table.rotationAngle && table.rotationAngle !== 0) {
                        tableElement.style.transform = `rotate(${table.rotationAngle}deg)`;
                        console.log(`Applied rotation: ${table.rotationAngle}deg`);
                    }                    // Set table content
                    tableElement.innerHTML = `
                        <div class="table-name-display">${table.name || `Table ${table.id}`}</div>
                        <div class="table-capacity-display">Cap: ${table.capacity}</div>
                        ${table.status === 'occupied' && table.seatedTime ? `
                            <div class="table-time-display" style="font-size: 0.7rem; color: #6b7280; margin-top: 2px;">
                                ${getTimeElapsed(table.seatedTime)}
                            </div>
                        ` : ''}
                        ${table.tags && table.tags.length > 0 ? `
                            <div class="table-tags" style="margin-top: 2px;">
                                ${table.tags.map(tag => `<span class="table-tag ${tag.type}" style="font-size: 0.6rem; padding: 1px 3px; margin: 1px;">${tag.emoji}</span>`).join('')}
                            </div>
                        ` : ''}
                    `;
                    
                    console.log(`Setting innerHTML: ${tableElement.innerHTML}`);
                    
                    // Add click handler
                    tableElement.onclick = () => selectTable(table.id);
                    
                    // Add data attributes for easier debugging
                    tableElement.setAttribute('data-table-id', table.id);
                    tableElement.setAttribute('data-table-status', table.status);
                    
                    console.log(`About to append table ${table.id} to canvas`);
                    floorPlanCanvas.appendChild(tableElement);
                    console.log(`Successfully appended table ${table.id}`);
                    
                    // Verify it was added
                    const addedElement = document.getElementById(`floor-table-${table.id}`);
                    console.log(`Verification - element exists in DOM:`, !!addedElement);
                    if (addedElement) {
                        const rect = addedElement.getBoundingClientRect();
                        console.log(`Element position in viewport:`, rect);
                    }
                    
                } catch (error) {
                    console.error(`Error rendering table ${table.id}:`, error);
                }
            });
            
            console.log(`Final canvas children count: ${floorPlanCanvas.children.length}`);
            console.log(`Rendered ${tables.length} tables in visual floor plan`);
            console.log('=== renderVisualFloorPlan() END ===');
        }// Select table for ordering
        function selectTable(tableId) {
            const table = tables.find(t => t.id === tableId);
            showTableModal(table);
        }        // Update table indicator in order cart
        function updateTableIndicator() {
            const indicator = document.getElementById('tableIndicator');
            const tableNumber = document.getElementById('tableNumber');
            const clearTableBtn = document.getElementById('clearTableBtn');
            
            if (selectedTable) {
                tableNumber.textContent = `T${selectedTable.id} (${selectedTable.capacity} seats)`;
                indicator.className = `table-indicator active ${selectedTable.status}`;
                if (clearTableBtn) clearTableBtn.style.display = 'block';
            } else {
                indicator.classList.remove('active');
                if (clearTableBtn) clearTableBtn.style.display = 'none';
            }
        }

        // Cancel table order function
        function cancelTableOrder() {
            if (cart.length > 0) {
                if (confirm('This will clear the current cart and cancel the table order. Are you sure?')) {
                    clearCart();
                    clearTableSelection();
                    showNotification('Table order cancelled successfully!', 'info');
                }
            } else {
                clearTableSelection();
                showNotification('Table selection cleared!', 'info');
            }
        }        // Clear table selection
        function clearTableSelection() {
            selectedTable = null;
            document.querySelectorAll('.table-item, .floor-plan-table').forEach(item => {
                item.classList.remove('selected');
            });
            updateTableIndicator();
        }        // Modal Functions
        function showTableModal(table) {
            const modal = document.getElementById('tableModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalTableDetails = document.getElementById('modalTableDetails');
            const modalActions = document.getElementById('modalActions');

            modalTitle.textContent = `Table ${table.id} Actions`;
            
            // Populate table details
            modalTableDetails.innerHTML = `
                <div class="detail-row">
                    <span class="detail-label">Table Number:</span>
                    <span class="detail-value">T${table.id}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Capacity:</span>
                    <span class="detail-value">${table.capacity} seats</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Status:</span>
                    <span class="detail-value" style="text-transform: capitalize; font-weight: 600; color: ${getStatusColor(table.status)}">${table.status}</span>
                </div>
                ${table.tags && table.tags.length > 0 ? `
                    <div class="detail-row">
                        <span class="detail-label">Special Events:</span>
                        <div class="detail-value">
                            <div class="table-tags">
                                ${table.tags.map(tag => `<span class="table-tag ${tag.type}">${tag.emoji} ${tag.name}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                ` : ''}
                ${table.status === 'occupied' ? `
                    <div class="detail-row">
                        <span class="detail-label">Current Guests:</span>
                        <span class="detail-value">${table.guests}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Server:</span>
                        <span class="detail-value">${table.server}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Order Time:</span>
                        <span class="detail-value">${table.orderTime}</span>
                    </div>
                ` : ''}
                ${table.status === 'reserved' ? `
                    <div class="detail-row">
                        <span class="detail-label">Reserved For:</span>
                        <span class="detail-value">${table.reservedBy}</span>
                    </div>
                ` : ''}
            `;

            // Populate action buttons based on table status
            modalActions.innerHTML = generateModalActions(table);

            modal.classList.add('active');
        }

        function closeTableModal() {
            const modal = document.getElementById('tableModal');
            modal.classList.remove('active');
        }

        function getStatusColor(status) {
            switch(status) {
                case 'available': return '#059669';
                case 'occupied': return '#dc2626';
                case 'reserved': return '#f59e0b';
                default: return '#6b7280';
            }
        }        function generateModalActions(table) {
            if (table.status === 'available') {
                return `
                    <button class="modal-btn secondary" onclick="closeTableModal()" style="opacity: 0.6; cursor: not-allowed;" disabled>🍽️ Take Order (No guests seated)</button>
                    <button class="modal-btn warning" onclick="makeReservation(${table.id})">📝 Make Reservation</button>
                    <button class="modal-btn primary" onclick="seatGuestsFromModal(${table.id})">👥 Seat Guests</button>
                    <button class="modal-btn secondary" onclick="showTableTagsModal(${table.id})">🏷️ Table Tags</button>
                    <button class="modal-btn secondary full-width" onclick="closeTableModal()">Cancel</button>
                `;
            } else if (table.status === 'occupied') {
                return `
                    <button class="modal-btn primary" onclick="takeOrder(${table.id})">🍽️ Take Order</button>
                    <button class="modal-btn secondary" onclick="printBill(${table.id})">🧾 Print Bill</button>
                    <button class="modal-btn danger" onclick="clearTable(${table.id})">🧹 Clear Table</button>
                    <button class="modal-btn secondary" onclick="showTableTagsModal(${table.id})">🏷️ Table Tags</button>
                    <button class="modal-btn secondary full-width" onclick="closeTableModal()">Cancel</button>
                `;
            } else if (table.status === 'reserved') {
                return `
                    <button class="modal-btn secondary" onclick="closeTableModal()" style="opacity: 0.6; cursor: not-allowed;" disabled>🍽️ Take Order (Guests not seated)</button>
                    <button class="modal-btn primary" onclick="seatGuests(${table.id})">👥 Seat Guests</button>
                    <button class="modal-btn danger" onclick="cancelReservation(${table.id})">❌ Cancel Reservation</button>
                    <button class="modal-btn secondary" onclick="showTableTagsModal(${table.id})">🏷️ Table Tags</button>
                    <button class="modal-btn secondary full-width" onclick="closeTableModal()">Cancel</button>
                `;
            }
        }// Table Action Functions
        function takeOrder(tableId) {
            const table = tables.find(t => t.id === tableId);
            
            // Only allow ordering if table has guests seated
            if (table.status !== 'occupied') {
                showNotification(`Cannot take order for Table ${tableId} - no guests seated!`, 'warning');
                closeTableModal();
                return;
            }
            
            selectedTable = table;
              // Update table visual selection
            document.querySelectorAll('.table-item, .floor-plan-table').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Find and select the table element
            const tableElements = document.querySelectorAll('.table-item, .floor-plan-table');
            tableElements.forEach(item => {
                if (item.textContent.includes(`T${tableId}`) || item.textContent.includes(`Table ${tableId}`)) {
                    item.classList.add('selected');
                }
            });
            
            updateTableIndicator();
            closeTableModal();
            
            // // Switch to menu
            const menuBtn = document.querySelector('.tab-button[onclick="switchTab(\'menu\')"]');
            if (menuBtn) {
                const clickEvent = new Event('click');
                Object.defineProperty(clickEvent, 'target', {
                    writable: false,
                    value: menuBtn
                });
                menuBtn.dispatchEvent(clickEvent);
            }
            
            showNotification(`Taking order for Table ${tableId} (${table.guests} guests)`, 'success');
        }        function makeReservation(tableId) {
            showReservationModal(tableId);
        }

        // Reservation Modal Functions
        let currentReservationTableId = null;

        function showReservationModal(tableId) {
            currentReservationTableId = tableId;
            const table = tables.find(t => t.id === tableId);
            const modal = document.getElementById('reservationModal');
            const title = document.getElementById('reservationModalTitle');
            
            title.textContent = `Make Reservation - Table ${tableId} (${table.capacity} seats)`;
            
            // Set default date to today and default time to current time + 1 hour
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            const nextHour = new Date(now.getTime() + 60 * 60 * 1000);
            const defaultTime = nextHour.toTimeString().slice(0, 5);
            
            document.getElementById('reservationDate').value = today;
            document.getElementById('reservationTime').value = defaultTime;
            
            // Clear form
            document.getElementById('reservationForm').reset();
            document.getElementById('reservationDate').value = today;
            document.getElementById('reservationTime').value = defaultTime;
            
            // Close table modal and show reservation modal
            closeTableModal();
            modal.classList.add('active');
        }

        function closeReservationModal() {
            const modal = document.getElementById('reservationModal');
            modal.classList.remove('active');
            currentReservationTableId = null;
            
            // Clear form
            document.getElementById('reservationForm').reset();
        }

        function submitReservation(event) {
            event.preventDefault();
            
            if (!currentReservationTableId) return;
            
            const formData = new FormData(event.target);
            const reservationData = {
                tableId: currentReservationTableId,
                customerName: formData.get('customerName'),
                customerPhone: formData.get('customerPhone'),
                customerEmail: formData.get('customerEmail'),
                date: formData.get('reservationDate'),
                time: formData.get('reservationTime'),
                partySize: formData.get('partySize'),
                occasion: formData.get('occasion'),
                specialRequests: formData.get('specialRequests'),
                highChair: formData.get('highChair') === 'on',
                wheelchair: formData.get('wheelchair') === 'on'
            };
            
            // Validate required fields
            if (!reservationData.customerName || !reservationData.customerPhone || 
                !reservationData.date || !reservationData.time || !reservationData.partySize) {
                showNotification('Please fill in all required fields', 'warning');
                return;
            }
            
            // Find the table and update it
            const table = tables.find(t => t.id === currentReservationTableId);
            if (table) {
                table.status = 'reserved';
                table.reservedBy = reservationData.customerName;
                table.reservationData = reservationData; // Store full reservation data
                
                // Apply occasion tag if selected
                if (reservationData.occasion && reservationData.occasion !== '') {
                    const occasionTags = {
                        'birthday': { emoji: '🎂', name: 'Birthday', type: 'birthday' },
                        'anniversary': { emoji: '💕', name: 'Anniversary', type: 'anniversary' },
                        'date': { emoji: '❤️', name: 'Date Night', type: 'date' },
                        'business': { emoji: '💼', name: 'Business', type: 'business' },
                        'celebration': { emoji: '🎉', name: 'Celebration', type: 'celebration' },
                        'other': { emoji: '🎊', name: 'Special Occasion', type: 'custom' }
                    };
                    
                    if (occasionTags[reservationData.occasion]) {
                        if (!table.tags) table.tags = [];
                        table.tags.push(occasionTags[reservationData.occasion]);
                    }
                }
                
                // Update visual state
                updateTableVisualState(currentReservationTableId, 'reserved');
                
                renderTables();
                saveTableStatuses();
                closeReservationModal();
                
                const dateTime = new Date(`${reservationData.date}T${reservationData.time}`);
                const formattedDateTime = dateTime.toLocaleString('en-US', {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit'
                });
                
                showNotification(`Reservation confirmed for ${reservationData.customerName} at Table ${currentReservationTableId} on ${formattedDateTime}`, 'success');            }
        }

        // Update table visual state helper function
        function updateTableVisualState(tableId, status) {
            // Update floor plan table visual state
            const floorPlanTable = document.getElementById(`floor-table-${tableId}`);
            if (floorPlanTable) {
                floorPlanTable.className = `floor-plan-table ${status} ${floorPlanTable.className.split(' ').find(c => ['circle', 'rectangle', 'square', 'booth', 'curved', 'bar-seat'].includes(c)) || 'square'}`;
            }
            
            // Update grid table visual state if it exists
            const gridTables = document.querySelectorAll(`.table-item`);
            gridTables.forEach(gridTable => {
                if (gridTable.textContent.includes(`T${tableId}`)) {
                    gridTable.className = `table-item ${status}`;
                }
            });
        }        function seatGuests(tableId) {
            const guestCount = prompt('How many guests?');
            if (guestCount && !isNaN(guestCount) && guestCount > 0) {
                const table = tables.find(t => t.id === tableId);
                if (table) {
                    table.status = 'occupied';
                    table.guests = parseInt(guestCount);
                    table.server = currentServerName || 'Current User';
                    table.orderTime = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    table.seatedTime = new Date().toISOString(); // Track when guests were seated
                    table.lastActivity = new Date().toISOString(); // Track last activity
                    table.reservedBy = '';
                    
                    // Update visual state
                    updateTableVisualState(tableId, 'occupied');
                    
                    renderTables();
                    saveTableStatuses();
                    closeTableModal();
                    showNotification(`Seated ${guestCount} guests at Table ${tableId}`, 'success');
                }
            }
        }        // Seat guests from available table modal and immediately take order
        function seatGuestsFromModal(tableId) {
            const guestCount = prompt('How many guests?');
            if (guestCount && !isNaN(guestCount) && guestCount > 0) {
                const table = tables.find(t => t.id === tableId);
                if (table) {
                    table.status = 'occupied';
                    table.guests = parseInt(guestCount);
                    table.server = currentServerName || 'Current User';
                    table.orderTime = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    table.seatedTime = new Date().toISOString(); // Track when guests were seated
                    table.lastActivity = new Date().toISOString(); // Track last activity
                    table.reservedBy = '';
                    
                    // Update visual state
                    updateTableVisualState(tableId, 'occupied');
                    
                    renderTables();
                    saveTableStatuses();
                    closeTableModal();
                    
                    
                    // Automatically start taking order after seating
                    selectedTable = table;
                    updateTableIndicator();
                    
                    // Switch to menu view for ordering
                    const menuBtn = document.querySelector('.tab-button[onclick="switchTab(\'menu\')"]');
                    if (menuBtn) {
                        const clickEvent = new Event('click');
                        Object.defineProperty(clickEvent, 'target', {
                            writable: false,
                            value: menuBtn
                        });
                        menuBtn.dispatchEvent(clickEvent);
                    }
                    
                    showNotification(`Seated ${guestCount} guests at Table ${tableId} - Ready to take order!`, 'success');
                }
            }
        }        function clearTable(tableId) {
            if (confirm('Are you sure you want to clear this table? This will mark it as available.')) {
                const table = tables.find(t => t.id === tableId);
                if (table) {
                    table.status = 'available';
                    table.guests = 0;
                    table.server = '';
                    table.orderTime = null;
                    table.seatedTime = null; // Clear seated time
                    table.lastActivity = null; // Clear last activity
                    table.reservedBy = '';
                    
                    // Update visual state
                    updateTableVisualState(tableId, 'available');
                    
                    renderTables();
                    saveTableStatuses();
                    closeTableModal();
                    showNotification(`Table ${tableId} cleared and available`, 'info');
                    
                    // Check for auto-ungrouping
                    autoUngroupEmptyTables();
                }
            }
        }        function cancelReservation(tableId) {
            if (confirm('Are you sure you want to cancel this reservation?')) {
                const table = tables.find(t => t.id === tableId);
                if (table) {
                    table.status = 'available';
                    table.reservedBy = '';
                    table.seatedTime = null; // Clear seated time if any
                    table.lastActivity = null; // Clear last activity if any
                    
                    // Update visual state
                    updateTableVisualState(tableId, 'available');
                    
                    renderTables();
                    saveTableStatuses();
                    closeTableModal();
                    showNotification(`Reservation canceled for Table ${tableId}`, 'warning');
                    
                    // Check for auto-ungrouping
                    autoUngroupEmptyTables();
                }
            }
        }        function printBill(tableId) {
            closeTableModal();
            showNotification(`Printing bill for Table ${tableId}`, 'info');
        }

        // Time Tracking Helper Functions
        function getTimeElapsed(startTime) {
            if (!startTime) return '';
            
            const start = new Date(startTime);
            const now = new Date();
            const diff = Math.floor((now - start) / 1000 / 60); // minutes
            
            if (diff < 60) {
                return `${diff}m`;
            } else {
                const hours = Math.floor(diff / 60);
                const minutes = diff % 60;
                return `${hours}h ${minutes}m`;
            }
        }

        function getTagColor(tagType) {
            const colors = {
                'birthday': '#f59e0b',
                'anniversary': '#ec4899',
                'vip': '#8b5cf6',
                'celebration': '#10b981',
                'business': '#6b7280',
                'date': '#ef4444',
                'custom': '#3b82f6'
            };
            return colors[tagType] || '#6b7280';
        }

        function updateTableLastActivity(tableId) {
            const table = tables.find(t => t.id === tableId);
            if (table && table.status === 'occupied') {
                table.lastActivity = new Date().toISOString();
                saveTableStatuses();
            }
        }

        function getTableTurnoverTime(table) {
            if (!table.seatedTime || table.status !== 'available') return null;
            
            const seated = new Date(table.seatedTime);
            const cleared = new Date(table.lastActivity || new Date());
            const diff = Math.floor((cleared - seated) / 1000 / 60); // minutes
            
            return diff;
        }// Close modal when clicking overlay
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('tableModal');
            const tablesModal = document.getElementById('tablesSelectionModal');
            const reservationModal = document.getElementById('reservationModal');
            const tagsModal = document.getElementById('tableTagsModal');
            
            if (event.target === modal) {
                closeTableModal();
            }
            if (event.target === tablesModal) {
                closeTablesSelectionModal();
            }
            if (event.target === reservationModal) {
                closeReservationModal();
            }
            if (event.target === tagsModal) {
                closeTableTagsModal();
            }
        });// Tables Selection Modal Functions
        function showTablesModal() {
            // Ensure tables are initialized
            if (tables.length === 0) {
                initializeTables();
            }
            
            const modal = document.getElementById('tablesSelectionModal');
            const tablesGrid = document.getElementById('tablesSelectionGrid');
            
            // Populate tables grid
            tablesGrid.innerHTML = tables.map(table => {
                const clickAction = table.status === 'occupied' ? `selectTableFromModal(${table.id})` : `showTableStatusMessage('${table.status}', ${table.id})`;
                
                return `
                    <div class="table-selection-item ${table.status}" onclick="${clickAction}">
                        <div class="table-selection-capacity">${table.capacity}</div>
                        <div class="table-selection-number">T${table.id}</div>
                        <div class="table-selection-status">${table.status}</div>
                        <div class="table-selection-info">
                            ${table.status === 'occupied' ? `${table.guests} guests` : ''}
                            ${table.status === 'reserved' ? table.reservedBy.substring(0, 10) + (table.reservedBy.length > 10 ? '...' : '') : ''}
                            ${table.status === 'available' ? 'No guests seated' : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            modal.classList.add('active');
        }

        function showTableStatusMessage(status, tableId) {
            if (status === 'available') {
                const seatNow = confirm(`Table ${tableId} has no guests seated. Would you like to seat guests now?`);
                if (seatNow) {
                    closeTablesSelectionModal();
                    const table = tables.find(t => t.id === tableId);
                    showTableModal(table);
                }
            } else if (status === 'reserved') {
                const seatNow = confirm(`Table ${tableId} is reserved but guests haven't been seated. Would you like to seat the guests now?`);
                if (seatNow) {
                    closeTablesSelectionModal();
                    const table = tables.find(t => t.id === tableId);
                    showTableModal(table);
                }
            }
        }        function closeTablesSelectionModal() {
            const modal = document.getElementById('tablesSelectionModal');
            modal.classList.remove('active');
        }

        // Table Tags Modal Functions
        let currentTagsTableId = null;

        function showTableTagsModal(tableId) {
            currentTagsTableId = tableId;
            const table = tables.find(t => t.id === tableId);
            const modal = document.getElementById('tableTagsModal');
            const title = document.getElementById('tagsModalTitle');
            
            title.textContent = `Table ${tableId} - Special Events`;
            
            // Clear all checkboxes
            const checkboxes = modal.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = false);
            
            // Clear custom input
            document.getElementById('customTagInput').value = '';
              // Check existing tags
            if (table.tags && table.tags.length > 0) {
                table.tags.forEach(tag => {
                    // Handle both old string format and new object format
                    if (typeof tag === 'string') {
                        // Old format - tag is just a string
                        const checkbox = document.getElementById(`tag-${tag}`);
                        if (checkbox) {
                            checkbox.checked = true;
                        } else if (tag !== 'birthday' && tag !== 'anniversary' && tag !== 'vip' && 
                                  tag !== 'celebration' && tag !== 'business' && tag !== 'date') {
                            // Custom tag
                            document.getElementById('customTagInput').value = tag;
                        }
                    } else if (typeof tag === 'object' && tag.type) {
                        // New format - tag is an object
                        if (tag.type === 'custom') {
                            document.getElementById('customTagInput').value = tag.name;
                        } else {
                            const checkbox = document.getElementById(`tag-${tag.type}`);
                            if (checkbox) {
                                checkbox.checked = true;
                            }
                        }
                    }
                });
            }
            
            modal.classList.add('active');
        }

        function closeTableTagsModal() {
            const modal = document.getElementById('tableTagsModal');
            modal.classList.remove('active');
            currentTagsTableId = null;
        }

        function toggleTag(tagName) {
            const checkbox = document.getElementById(`tag-${tagName}`);
            checkbox.checked = !checkbox.checked;
        }        function saveTableTags() {
            if (!currentTagsTableId) return;
            
            const table = tables.find(t => t.id === currentTagsTableId);
            const selectedTags = [];
            
            // Define tag metadata
            const tagMetadata = {
                'birthday': { emoji: '🎂', name: 'Birthday', type: 'birthday' },
                'anniversary': { emoji: '💕', name: 'Anniversary', type: 'anniversary' },
                'vip': { emoji: '👑', name: 'VIP', type: 'vip' },
                'celebration': { emoji: '🎉', name: 'Celebration', type: 'celebration' },
                'business': { emoji: '💼', name: 'Business', type: 'business' },
                'date': { emoji: '❤️', name: 'Date Night', type: 'date' }
            };
            
            // Get checked predefined tags
            const checkboxes = document.querySelectorAll('#tableTagsModal input[type="checkbox"]:checked');
            checkboxes.forEach(cb => {
                const tagName = cb.id.replace('tag-', '');
                if (tagMetadata[tagName]) {
                    selectedTags.push(tagMetadata[tagName]);
                }
            });
            
            // Get custom tag
            const customTag = document.getElementById('customTagInput').value.trim();
            if (customTag) {
                selectedTags.push({
                    emoji: '🏷️',
                    name: customTag,
                    type: 'custom'
                });
            }
            
            // Update table tags
            table.tags = selectedTags;
            
            // Save to localStorage
            saveTableStatuses();
            
            // Update the floor plan display
            renderTables();
              // Show notification
            if (selectedTags.length > 0) {
                const tagNames = selectedTags.map(tag => tag.name).join(', ');
                showNotification(`Tags saved for Table ${currentTagsTableId}: ${tagNames}`, 'success');
            } else {
                showNotification(`All tags cleared for Table ${currentTagsTableId}`, 'success');
            }
            
            closeTableTagsModal();
        }

        function clearAllTags() {
            const checkboxes = document.querySelectorAll('#tableTagsModal input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = false);
            document.getElementById('customTagInput').value = '';
        }

        function selectTableFromModal(tableId) {
            const table = tables.find(t => t.id === tableId);
            
            // Only allow ordering for occupied tables
            if (table.status !== 'occupied') {
                showNotification(`Cannot take order for Table ${tableId} - no guests seated!`, 'warning');
                return;
            }
            
            // Close the modal first
            closeTablesSelectionModal();
            
            // Set selected table and update indicator
            selectedTable = table;
            updateTableIndicator();
            
            // Switch to menu view for ordering
            const menuBtn = document.querySelector('.tab-button[onclick="switchTab(\'menu\')"]');
            if (menuBtn) {
                const clickEvent = new Event('click');
                Object.defineProperty(clickEvent, 'target', {
                    writable: false,
                    value: menuBtn
                });
                menuBtn.dispatchEvent(clickEvent);
            }
            
            showNotification(`Taking order for Table ${tableId} (${table.guests} guests)`, 'success');
        }        // Menu Management Functions
        function loadMenu() {
            const savedMenu = localStorage.getItem('menuItems');
            let menuItems = [];
            
            if (savedMenu) {
                menuItems = JSON.parse(savedMenu);
            }
            
            renderMenu(menuItems);
        }        function renderMenu(menuItems) {
            const menuGrid = document.getElementById('menuGrid');
            
            if (menuItems.length === 0) {
                menuGrid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #9ca3af;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">🍽️</div>
                        <p>No menu items available</p>
                        <p style="font-size: 0.8rem; margin-bottom: 1rem;">Add items using the menu editor</p>
                        <button onclick="window.location.href='menu-editor.html'" style="background: #3b82f6; color: white; border: 2px solid #000; padding: 0.75rem 1.5rem; font-family: 'Courier New', monospace; cursor: pointer; border-radius: 4px;">
                            Open Menu Editor
                        </button>
                    </div>
                `;
                return;
            }
              // Filter only items available today
            const availableItems = menuItems.filter(item => isItemAvailableToday(item));
            
            if (availableItems.length === 0) {
                menuGrid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #9ca3af;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">😴</div>
                        <p>No items available for ordering</p>
                        <p style="font-size: 0.8rem;">All menu items are currently unavailable or 86'd for today</p>
                    </div>
                `;
                return;
            }
            
            menuGrid.innerHTML = availableItems.map(item => `
                <div class="menu-item" onclick="addToCart('${item.id}', '${item.name}', ${item.price})" title="${item.description || ''}">
                    <div class="item-image">${item.emoji}</div>
                    <div class="item-name">${item.name}</div>
                    <div class="item-price">$${item.price.toFixed(2)}</div>
                    <div class="item-actions">
                        <button class="item-btn customize-btn" onclick="event.stopPropagation(); customizeItem('${item.id}')">Customize</button>
                        <button class="item-btn details-btn" onclick="event.stopPropagation(); showDetails('${item.id}')">Details</button>
                    </div>
                </div>
            `).join('');
        }        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadMenuItems();
            updateCartDisplay();
            updateKitchenDisplay();
            initializeTables(); // Initialize tables on page load
            initializeKeyboardShortcuts(); // Initialize keyboard shortcuts
            
            // Initialize property switcher for multi-property system
            if (typeof PropertySwitcher !== 'undefined') {
                PropertySwitcher.initialize();
            }
        });
        
        // Refresh floor plan from localStorage
        function refreshFloorPlan() {
            console.log('Refreshing floor plan...');
            
            // Clear current tables data
            tables = [];
            
            // Reinitialize tables from localStorage
            initializeTables();
            
            // Show notification
            showNotification('Floor plan refreshed!', 'info');
        }        // Debug function to create sample floor plan data
        function createSampleFloorPlanData() {
            const sampleData = [
                {
                    id: 'table-1',
                    name: 'Circle Table 1',
                    capacity: '4',
                    left: '100px',
                    top: '80px',
                    width: '80px',
                    height: '80px',
                    shapeType: 'circle',
                    rotationAngle: 0
                },
                {
                    id: 'table-2',
                    name: 'Rectangle Table 2',
                    capacity: '6',
                    left: '250px',
                    top: '80px',
                    width: '120px',
                    height: '70px',
                    shapeType: 'rectangle',
                    rotationAngle: 0
                },
                {
                    id: 'table-3',
                    name: 'Booth Table 3',
                    capacity: '4',
                    left: '100px',
                    top: '200px',
                    width: '180px',
                    height: '70px',
                    shapeType: 'booth',
                    rotationAngle: 0
                }
            ];
            
            localStorage.setItem('floorPlan', JSON.stringify(sampleData));
            console.log('Sample floor plan data created');
            
            // Refresh the interface
            refreshFloorPlan();
            
            // Also try direct injection test
            testDirectTableInjection();
            
            showNotification('Sample floor plan created!', 'success');
        }        // Emergency debug function to force tables to show
        function emergencyDebug() {
            console.log('🚨 EMERGENCY DEBUG - FORCING TABLES TO SHOW');
            
            // Step 1: Clear everything
            localStorage.removeItem('floorPlan');
            localStorage.removeItem('tableStatuses');
            
            // Step 2: Create data directly with console logging
            const testData = [
                {
                    id: 'table-1',
                    name: 'Emergency Table 1',
                    capacity: '4',
                    left: '100px',
                    top: '80px',
                    width: '80px',
                    height: '80px',
                    shapeType: 'circle',
                    rotationAngle: 0
                },
                {
                    id: 'table-2',
                    name: 'Emergency Table 2',
                    capacity: '6',
                    left: '250px',
                    top: '120px',
                    width: '120px',
                    height: '70px',
                    shapeType: 'rectangle',
                    rotationAngle: 0
                }
            ];
            
            console.log('Emergency data created:', testData);
            localStorage.setItem('floorPlan', JSON.stringify(testData));
            
            // Step 3: Force reinitialize
            console.log('Forcing reinitialization...');
            tables = [];
            initializeTables();
            
            // Step 4: Check tables array
            console.log('Tables after emergency init:', tables);
            console.log('Tables with left property:', tables.filter(t => t.left));
            
            // Step 5: Force condition check
            const hasPositions = tables.some(table => table.left);
            console.log('Emergency condition check result:', hasPositions);
            
            // Step 6: If still false, manually set tables with positions
            if (!hasPositions) {
                console.log('🔧 Condition still false, manually fixing tables array...');
                tables = testData.map((tableData, index) => ({
                    id: index + 1,
                    capacity: parseInt(tableData.capacity) || 2,
                    status: 'available',
                    guests: 0,
                    server: '',
                    orderTime: null,
                    reservedBy: '',
                    tags: [],
                    left: tableData.left,
                    top: tableData.top,
                    width: tableData.width,
                    height: tableData.height,
                    shapeType: tableData.shapeType || 'square',
                    name: tableData.name,
                    rotationAngle: tableData.rotationAngle || 0
                }));
                console.log('Manually fixed tables array:', tables);
            }
            
            // Step 7: Force render
            console.log('Force rendering tables...');
            renderTables();
              // Step 8: If still not working, bypass everything and inject directly
            setTimeout(() => {
                const canvas = document.getElementById('floorPlanCanvas');
                if (canvas && canvas.children.length === 0) {
                    console.log('🚨 Still no tables, forcing direct DOM injection...');
                    
                    // Clear any placeholder content
                    canvas.innerHTML = '';
                    
                    // Create tables directly in DOM
                    testData.forEach((tableData, index) => {
                        const tableElement = document.createElement('div');
                        tableElement.className = 'floor-plan-table available ' + tableData.shapeType;
                        tableElement.id = `emergency-table-${index + 1}`;
                        tableElement.style.position = 'absolute';
                        tableElement.style.left = tableData.left;
                        tableElement.style.top = tableData.top;
                        tableElement.style.width = tableData.width;
                        tableElement.style.height = tableData.height;
                        tableElement.style.border = '3px solid #059669';
                        tableElement.style.background = '#f0fdf4';
                        tableElement.style.display = 'flex';
                        tableElement.style.alignItems = 'center';
                        tableElement.style.justifyContent = 'center';
                        tableElement.style.flexDirection = 'column';
                        tableElement.style.fontFamily = '"Courier New", monospace';
                        tableElement.style.fontWeight = 'bold';
                        tableElement.style.cursor = 'pointer';
                        
                        tableElement.innerHTML = `
                            <div style="font-size: 0.75rem; margin-bottom: 0.25rem;">${tableData.name}</div>
                            <div style="font-size: 0.625rem; color: #6b7280;">Cap: ${tableData.capacity}</div>
                        `;
                        
                        canvas.appendChild(tableElement);
                        console.log('Emergency table injected:', tableElement.id);
                    });
                    
                    console.log('🎉 Emergency injection complete - tables should now be visible!');
                } else if (canvas && canvas.children.length > 0) {
                    console.log('🎨 Tables exist in DOM, applying emergency visibility CSS...');
                    
                    // Force all existing tables to be visible
                    const existingTables = canvas.querySelectorAll('.floor-plan-table');
                    existingTables.forEach((table, index) => {
                        table.style.background = 'red';
                        table.style.border = '5px solid blue';
                        table.style.color = 'white';
                        table.style.zIndex = '9999';
                        table.style.display = 'flex';
                        table.style.position = 'absolute';
                        table.style.fontSize = '14px';
                        table.style.fontWeight = 'bold';
                        console.log(`Applied emergency CSS to existing table ${index + 1}:`, table);
                    });
                    
                    console.log('🎉 Emergency CSS applied to existing tables!');
                }
            }, 1000);
            
            showNotification('Emergency debug executed! Check console and look for tables.', 'warning');
        }

        // Test function to inject a table directly into the canvas
        function testDirectTableInjection() {
            console.log('Testing direct table injection...');
            const floorPlanCanvas = document.getElementById('floorPlanCanvas');
            
            if (!floorPlanCanvas) {
                console.error('Floor plan canvas not found for direct injection test');
                return;
            }

            // Create a bright red test table that should be very obvious
            const testTable = document.createElement('div');
            testTable.className = 'floor-plan-table available circle';
            testTable.id = 'direct-test-table';
            testTable.style.position = 'absolute';
            testTable.style.left = '50px';
            testTable.style.top = '50px';
            testTable.style.width = '100px';
            testTable.style.height = '100px';
            testTable.style.background = 'red';
            testTable.style.border = '3px solid black';
            testTable.style.zIndex = '1000';
            testTable.style.display = 'flex';
            testTable.style.alignItems = 'center';
            testTable.style.justifyContent = 'center';
            testTable.innerHTML = '<div style="color: white; font-weight: bold;">TEST</div>';
            
            // Add to canvas
            floorPlanCanvas.appendChild(testTable);
            console.log('Direct test table injected');
            
            // Remove after 5 seconds
            setTimeout(() => {
                if (testTable.parentNode) {
                    testTable.parentNode.removeChild(testTable);
                    console.log('Direct test table removed');
                }
            }, 5000);
        }

        // Debug function - can be called from browser console
        window.debugFloorPlan = function() {
            console.log('=== FLOOR PLAN DEBUG ===');
            console.log('Current tables array:', tables);
            console.log('Tables length:', tables.length);
            
            if (tables.length > 0) {
                console.log('Sample table structure:', tables[0]);
                tables.forEach((table, index) => {
                    console.log(`Table ${index + 1}:`, {
                        id: table.id,
                        hasPosition: !!table.position,
                        position: table.position
                    });
                });
            }
            
            const floorPlanCanvas = document.getElementById('floorPlanCanvas');
            console.log('Floor plan canvas element:', floorPlanCanvas);
            console.log('Canvas children count:', floorPlanCanvas ? floorPlanCanvas.children.length : 'No canvas');
            
            const savedPlan = localStorage.getItem('floorPlan');
            console.log('Raw localStorage data:', savedPlan);
            
            if (savedPlan) {
                try {
                    const parsed = JSON.parse(savedPlan);
                    console.log('Parsed localStorage data:', parsed);
                } catch (e) {
                    console.error('Error parsing localStorage data:', e);
                }
            }
              console.log('=== END DEBUG ===');
            return { tables, floorPlanCanvas, savedPlan };
        };

        // Room Service Management
        let roomServiceMenu = [];
        let roomServiceCart = [];
        let roomServiceTaxRate = 0.0875; // 8.75% default tax rate
        let roomServiceServiceCharge = 0.18; // 18% service charge

        // Initialize room service functionality
        function initializeRoomService() {
            console.log('Initializing Room Service...');
            
            // Check if HotelMode is available
            if (typeof HotelMode === 'undefined') {
                console.warn('HotelMode not available - room service features limited');
                return;
            }

            // Load loyalty program information
            loadLoyaltyProgram();
            
            // Load room service menu
            loadRoomServiceMenu();
            
            // Set up form validation
            setupFormValidation();
            
            // Load tax rate from settings
            loadTaxRate();
            
            console.log('Room Service initialized successfully');
        }

        function loadLoyaltyProgram() {
            if (typeof HotelMode === 'undefined') return;
            
            const programName = HotelMode.getLoyaltyProgramName();
            const loyaltyTiers = HotelMode.getLoyaltyTiers();
            
            // Update program name in header
            const programElement = document.getElementById('loyaltyProgramName');
            if (programElement) {
                programElement.textContent = programName;
            }
            
            // Populate loyalty status dropdown
            const loyaltySelect = document.getElementById('loyaltyStatus');
            if (loyaltySelect) {
                loyaltySelect.innerHTML = '<option value="">Select loyalty status</option>';
                
                loyaltyTiers.forEach(tier => {
                    const option = document.createElement('option');
                    option.value = tier.toLowerCase().replace(/\s+/g, '-');
                    option.textContent = tier;
                    loyaltySelect.appendChild(option);
                });
            }
        }

        function loadRoomServiceMenu() {
            if (typeof HotelMode === 'undefined') {
                // Fallback to restaurant menu if HotelMode not available
                roomServiceMenu = [...restaurantMenu];
                renderRoomServiceMenu();
                return;
            }
            
            // Get room service menu from HotelMode
            roomServiceMenu = HotelMode.getRoomServiceMenu();
            
            if (roomServiceMenu.length === 0) {
                // Initialize if empty
                roomServiceMenu = HotelMode.initializeRoomServiceMenu();
            }
            
            renderRoomServiceMenu();
            updateMenuSyncStatus();
        }

        function renderRoomServiceMenu() {
            const menuGrid = document.getElementById('roomServiceMenuGrid');
            if (!menuGrid) return;
            
            if (roomServiceMenu.length === 0) {
                menuGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #9ca3af;">
                        <span style="font-size: 3rem;">🍽️</span>
                        <p>No menu items available</p>
                        <button onclick="initializeFromRestaurant()" style="background: #4f46e5; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">
                            Initialize from Restaurant Menu
                        </button>
                    </div>
                `;
                return;
            }
            
            menuGrid.innerHTML = roomServiceMenu.map(item => `
                <div class="menu-item" onclick="addToRoomServiceCart('${item.id}')">
                    <h4>${item.name}</h4>
                    <p class="description">${item.description || ''}</p>
                    <p class="price">$${item.price.toFixed(2)}</p>
                    ${item.roomServiceOnly ? '<span class="room-service-only">Room Service Only</span>' : ''}
                </div>
            `).join('');
        }

        function setupFormValidation() {
            // Add form validation for room service order
            const form = document.getElementById('roomServiceForm');
            if (form) {
                form.addEventListener('submit', handleRoomServiceOrder);
            }
        }

        function loadTaxRate() {
            // Load tax rate from business settings or use default
            const savedSettings = localStorage.getItem('businessSettings');
            if (savedSettings) {
                try {
                    const settings = JSON.parse(savedSettings);
                    roomServiceTaxRate = settings.taxRate || 0.0875;
                } catch (error) {
                    console.error('Error loading tax rate:', error);
                }
            }
        }

        function addToRoomServiceCart(itemId) {
            const item = roomServiceMenu.find(i => i.id === itemId);
            if (!item) return;
            
            const existingItem = roomServiceCart.find(i => i.id === itemId);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                roomServiceCart.push({
                    ...item,
                    quantity: 1
                });
            }
            
            updateRoomServiceCartDisplay();
        }        function updateRoomServiceCartDisplay() {
            const cartItems = document.getElementById('roomServiceCartItems');
            const subtotalElement = document.getElementById('roomServiceSubtotal');
            const serviceChargeElement = document.getElementById('roomServiceServiceCharge');
            const taxElement = document.getElementById('roomServiceTax');
            const totalElement = document.getElementById('roomServiceTotal');
            
            if (!cartItems) return;
            
            if (roomServiceCart.length === 0) {
                cartItems.innerHTML = `
                    <div class="room-service-empty-state">
                        <div class="empty-cart-icon">🛒</div>
                        <p>Your cart is empty</p>
                        <span>Add items from the menu to get started</span>
                    </div>
                `;
                if (subtotalElement) subtotalElement.textContent = '$0.00';
                if (serviceChargeElement) serviceChargeElement.textContent = '$0.00';
                if (taxElement) taxElement.textContent = '$0.00';
                if (totalElement) totalElement.textContent = '$0.00';
                return;
            }
            
            const subtotal = roomServiceCart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const serviceCharge = subtotal * roomServiceServiceCharge;
            const tax = (subtotal + serviceCharge) * roomServiceTaxRate;
            const total = subtotal + serviceCharge + tax;
            
            cartItems.innerHTML = roomServiceCart.map(item => `
                <div class="room-service-cart-item">
                    <div class="cart-item-header">
                        <h4 class="cart-item-name">${item.name}</h4>
                        <span class="cart-item-price">$${item.price.toFixed(2)}</span>
                    </div>
                    <div class="cart-item-footer">
                        <div class="quantity-controls">
                            <button onclick="updateRoomServiceQuantity('${item.id}', ${item.quantity - 1})" class="quantity-btn" ${item.quantity <= 1 ? 'disabled' : ''}>−</button>
                            <span class="quantity-display">${item.quantity}</span>
                            <button onclick="updateRoomServiceQuantity('${item.id}', ${item.quantity + 1})" class="quantity-btn">+</button>
                        </div>
                        <div class="cart-item-total">
                            <span class="total-price">$${(item.price * item.quantity).toFixed(2)}</span>
                            <button onclick="removeFromRoomServiceCart('${item.id}')" class="remove-item-btn" title="Remove item">🗑️</button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            if (subtotalElement) subtotalElement.textContent = `$${subtotal.toFixed(2)}`;
            if (serviceChargeElement) serviceChargeElement.textContent = `$${serviceCharge.toFixed(2)}`;
            if (taxElement) taxElement.textContent = `$${tax.toFixed(2)}`;
            if (totalElement) totalElement.textContent = `$${total.toFixed(2)}`;
        }        function removeFromRoomServiceCart(itemId) {
            const index = roomServiceCart.findIndex(i => i.id === itemId);
            if (index !== -1) {
                roomServiceCart.splice(index, 1);
                updateRoomServiceCartDisplay();
            }
        }

        function updateRoomServiceQuantity(itemId, newQuantity) {
            if (newQuantity <= 0) {
                removeFromRoomServiceCart(itemId);
                return;
            }
            
            const index = roomServiceCart.findIndex(i => i.id === itemId);
            if (index !== -1) {
                roomServiceCart[index].quantity = newQuantity;
                updateRoomServiceCartDisplay();
            }
        }

        function handleRoomServiceOrder(event) {
            event.preventDefault();
            
            const guestName = document.getElementById('guestName').value;
            const roomNumber = document.getElementById('roomNumber').value;
            const specialInstructions = document.getElementById('specialInstructions').value;
            
            if (!guestName || !roomNumber || roomServiceCart.length === 0) {
                alert('Please fill in all required fields and add items to cart');
                return;
            }
            
            const order = {
                id: 'RS' + Date.now(),
                type: 'room-service',
                guestName,
                roomNumber,
                items: [...roomServiceCart],
                specialInstructions,
                status: 'pending',
                timestamp: new Date().toISOString(),
                subtotal: roomServiceCart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                serviceCharge: roomServiceCart.reduce((sum, item) => sum + (item.price * item.quantity), 0) * roomServiceServiceCharge,
                tax: (roomServiceCart.reduce((sum, item) => sum + (item.price * item.quantity), 0) * (1 + roomServiceServiceCharge)) * roomServiceTaxRate,
                total: roomServiceCart.reduce((sum, item) => sum + (item.price * item.quantity), 0) * (1 + roomServiceServiceCharge + roomServiceTaxRate)
            };
            
            // Add to kitchen orders
            kitchenOrders.push(order);
            localStorage.setItem('kitchenOrders', JSON.stringify(kitchenOrders));
            
            // Clear cart and form
            roomServiceCart = [];
            document.getElementById('roomServiceForm').reset();
            updateRoomServiceCartDisplay();
            
            // Show success message
            showNotification('Room service order sent to kitchen!', 'success');
            
            console.log('Room service order processed:', order);
        }

        function initializeFromRestaurant() {
            if (typeof HotelMode !== 'undefined') {
                roomServiceMenu = HotelMode.initializeRoomServiceMenu();
            } else {
                roomServiceMenu = [...restaurantMenu];
            }
            renderRoomServiceMenu();
        }

        function updateMenuSyncStatus() {
            const syncStatus = document.getElementById('menuSyncStatus');
            if (syncStatus) {
                const lastSync = new Date().toLocaleString();
                syncStatus.textContent = `Last synced: ${lastSync}`;
            }
        }

        // Table Grouping System Variables
        let selectedTables = new Set();
        let isDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let tableGroups = new Map(); // groupId -> Set of table IDs
        let nextGroupId = 1;
        let contextMenuTableId = null;

        // Initialize table drag selection functionality
        function initializeTableDragSelection() {
            console.log('Initializing table drag selection...');
            const floorPlanCanvas = document.getElementById('floorPlanCanvas');
            if (!floorPlanCanvas) return;

            let isSelecting = false;
            let selectionBox = null;
            let startX = 0;
            let startY = 0;

            // Handle mouse down on floor plan canvas
            floorPlanCanvas.addEventListener('mousedown', function(e) {
                // Only start selection if clicking on empty space (not a table)
                if (!e.target.classList.contains('floor-plan-table') && e.target === floorPlanCanvas) {
                    isSelecting = true;
                    const rect = floorPlanCanvas.getBoundingClientRect();
                    startX = e.clientX - rect.left;
                    startY = e.clientY - rect.top;
                    
                    // Create selection marquee
                    selectionBox = document.getElementById('tableSelectionMarquee');
                    selectionBox.style.left = startX + 'px';
                    selectionBox.style.top = startY + 'px';
                    selectionBox.style.width = '0px';
                    selectionBox.style.height = '0px';
                    selectionBox.style.display = 'block';
                    
                    // Clear existing selections if not holding Ctrl
                    if (!e.ctrlKey && !e.metaKey) {
                        clearTableSelections();
                    }
                    
                    e.preventDefault();
                }
            });

            // Handle mouse move during selection
            document.addEventListener('mousemove', function(e) {
                if (!isSelecting || !selectionBox) return;
                
                const rect = floorPlanCanvas.getBoundingClientRect();
                const currentX = e.clientX - rect.left;
                const currentY = e.clientY - rect.top;
                
                const left = Math.min(startX, currentX);
                const top = Math.min(startY, currentY);
                const width = Math.abs(currentX - startX);
                const height = Math.abs(currentY - startY);
                
                selectionBox.style.left = left + 'px';
                selectionBox.style.top = top + 'px';
                selectionBox.style.width = width + 'px';
                selectionBox.style.height = height + 'px';
                
                // Highlight tables within selection
                updateTableSelection(left, top, width, height);
            });

            // Handle mouse up to finish selection
            document.addEventListener('mouseup', function(e) {
                if (isSelecting) {
                    isSelecting = false;
                    if (selectionBox) {
                        selectionBox.style.display = 'none';
                    }
                    updateSelectionUI();
                }
            });

            // Handle individual table clicks for selection
            floorPlanCanvas.addEventListener('click', function(e) {
                if (e.target.classList.contains('floor-plan-table')) {
                    const tableId = parseInt(e.target.getAttribute('data-table-id'));
                    
                    if (e.ctrlKey || e.metaKey) {
                        // Toggle selection
                        if (selectedTables.has(tableId)) {
                            selectedTables.delete(tableId);
                            e.target.classList.remove('drag-selected');
                        } else {
                            selectedTables.add(tableId);
                            e.target.classList.add('drag-selected');
                        }
                    } else {
                        // Single selection or show table modal if nothing selected
                        if (selectedTables.size === 0) {
                            const table = tables.find(t => t.id === tableId);
                            if (table) {
                                showTableModal(table);
                            }
                        } else {
                            clearTableSelections();
                            selectedTables.add(tableId);
                            e.target.classList.add('drag-selected');
                        }
                    }
                    updateSelectionUI();
                    e.stopPropagation();
                }
            });
        }

        // Update table selection based on marquee bounds
        function updateTableSelection(left, top, width, height) {
            const tableElements = document.querySelectorAll('.floor-plan-table');
            
            tableElements.forEach(tableElement => {
                const tableRect = tableElement.getBoundingClientRect();
                const canvasRect = document.getElementById('floorPlanCanvas').getBoundingClientRect();
                
                const tableLeft = tableRect.left - canvasRect.left;
                const tableTop = tableRect.top - canvasRect.top;
                const tableRight = tableLeft + tableRect.width;
                const tableBottom = tableTop + tableRect.height;
                
                const selectionRight = left + width;
                const selectionBottom = top + height;
                
                // Check if table intersects with selection
                const intersects = !(tableRight < left || tableLeft > selectionRight || 
                                   tableBottom < top || tableTop > selectionBottom);
                
                const tableId = parseInt(tableElement.getAttribute('data-table-id'));
                
                if (intersects) {
                    selectedTables.add(tableId);
                    tableElement.classList.add('drag-selected');
                } else {
                    selectedTables.delete(tableId);
                    tableElement.classList.remove('drag-selected');
                }
            });
        }

        // Initialize table context menu
        function initializeTableContextMenu() {
            console.log('Initializing table context menu...');
            const contextMenu = document.getElementById('tableContextMenu');
            if (!contextMenu) return;

            // Handle right-click on tables
            document.addEventListener('contextmenu', function(e) {
                if (e.target.classList.contains('floor-plan-table')) {
                    e.preventDefault();
                    
                    const tableId = parseInt(e.target.getAttribute('data-table-id'));
                    contextMenuTableId = tableId;
                    
                    // If table isn't selected, select it
                    if (!selectedTables.has(tableId)) {
                        clearTableSelections();
                        selectedTables.add(tableId);
                        e.target.classList.add('drag-selected');
                        updateSelectionUI();
                    }
                    
                    // Update context menu options
                    updateContextMenu(tableId);
                    
                    // Position and show context menu
                    contextMenu.style.left = e.pageX + 'px';
                    contextMenu.style.top = e.pageY + 'px';
                    contextMenu.style.display = 'block';
                }
            });

            // Hide context menu on click elsewhere
            document.addEventListener('click', function(e) {
                if (!contextMenu.contains(e.target)) {
                    contextMenu.style.display = 'none';
                }
            });
        }

        // Update context menu based on selection
        function updateContextMenu(tableId) {
            const groupMenuItem = document.getElementById('groupTablesMenuItem');
            const ungroupMenuItem = document.getElementById('ungroupTableMenuItem');
            
            const table = tables.find(t => t.id === tableId);
            const isGrouped = table && table.groupId;
            
            if (selectedTables.size > 1) {
                groupMenuItem.style.display = 'block';
                groupMenuItem.classList.remove('disabled');
            } else {
                groupMenuItem.style.display = isGrouped ? 'none' : 'block';
                groupMenuItem.classList.add('disabled');
            }
            
            ungroupMenuItem.style.display = isGrouped ? 'block' : 'none';
        }

        // Load saved table groups
        function loadTableGroups() {
            console.log('Loading table groups...');
            const savedGroups = localStorage.getItem('tableGroups');
            if (savedGroups) {
                try {
                    const groupsData = JSON.parse(savedGroups);
                    tableGroups.clear();
                    nextGroupId = 1;
                    
                    Object.entries(groupsData).forEach(([groupId, tableIds]) => {
                        tableGroups.set(parseInt(groupId), new Set(tableIds));
                        nextGroupId = Math.max(nextGroupId, parseInt(groupId) + 1);
                    });
                    
                    // Apply group data to tables
                    tables.forEach(table => {
                        table.groupId = null;
                        for (const [groupId, tableIds] of tableGroups.entries()) {
                            if (tableIds.has(table.id)) {
                                table.groupId = groupId;
                                break;
                            }
                        }
                    });
                    
                    console.log('Loaded table groups:', tableGroups);
                } catch (error) {
                    console.error('Error loading table groups:', error);
                }
            }
        }

        // Save table groups to localStorage
        function saveTableGroups() {
            const groupsData = {};
            tableGroups.forEach((tableIds, groupId) => {
                groupsData[groupId] = Array.from(tableIds);
            });
            localStorage.setItem('tableGroups', JSON.stringify(groupsData));
        }

        // Clear table selections
        function clearTableSelections() {
            selectedTables.clear();
            document.querySelectorAll('.floor-plan-table.drag-selected').forEach(table => {
                table.classList.remove('drag-selected');
            });
            updateSelectionUI();
        }

        // Update selection UI elements
        function updateSelectionUI() {
            const clearBtn = document.getElementById('clearSelectionBtn');
            if (clearBtn) {
                clearBtn.style.display = selectedTables.size > 0 ? 'block' : 'none';
                clearBtn.textContent = `Clear Selection (${selectedTables.size})`;
            }
        }

        // Group selected tables
        function groupSelectedTables() {
            if (selectedTables.size < 2) {
                showNotification('Please select at least 2 tables to group', 'warning');
                return;
            }
            
            const groupId = nextGroupId++;
            const tableIds = Array.from(selectedTables);
            
            // Create new group
            tableGroups.set(groupId, new Set(tableIds));
            
            // Update table objects
            tableIds.forEach(tableId => {
                const table = tables.find(t => t.id === tableId);
                if (table) {
                    table.groupId = groupId;
                }
            });
            
            // Update visual state
            updateGroupedTablesDisplay();
            saveTableGroups();
            saveTableStatuses();
            
            const tableNames = tableIds.map(id => `T${id}`).join(', ');
            showNotification(`Tables ${tableNames} have been grouped together`, 'success');
            
            // Hide context menu and clear selection
            document.getElementById('tableContextMenu').style.display = 'none';
            clearTableSelections();
        }

        // Ungroup a table
        function ungroupTable() {
            if (!contextMenuTableId) return;
            
            const table = tables.find(t => t.id === contextMenuTableId);
            if (!table || !table.groupId) return;
            
            const groupId = table.groupId;
            const group = tableGroups.get(groupId);
            
            if (group) {
                // Remove table from group
                group.delete(contextMenuTableId);
                
                // If group becomes empty or has only one table, remove it entirely
                if (group.size <= 1) {
                    // Clear groupId for remaining table
                    group.forEach(tableId => {
                        const remainingTable = tables.find(t => t.id === tableId);
                        if (remainingTable) {
                            remainingTable.groupId = null;
                        }
                    });
                    tableGroups.delete(groupId);
                } else {
                    // Just remove this table from the group
                    table.groupId = null;
                }
            }
            
            // Update visual state
            updateGroupedTablesDisplay();
            saveTableGroups();
            saveTableStatuses();
            
            showNotification(`Table T${contextMenuTableId} has been ungrouped`, 'info');
            
            // Hide context menu
            document.getElementById('tableContextMenu').style.display = 'none';
        }

        // Update visual display of grouped tables
        function updateGroupedTablesDisplay() {
            // Remove all grouped styling
            document.querySelectorAll('.floor-plan-table.grouped').forEach(table => {
                table.classList.remove('grouped');
                const badge = table.querySelector('.group-info-badge');
                if (badge) badge.remove();
            });
            
            // Apply grouped styling to current groups
            tableGroups.forEach((tableIds, groupId) => {
                tableIds.forEach(tableId => {
                    const tableElement = document.getElementById(`floor-table-${tableId}`);
                    if (tableElement) {
                        tableElement.classList.add('grouped');
                        
                        // Add group info badge
                        const badge = document.createElement('div');
                        badge.className = 'group-info-badge';
                        badge.textContent = `Group ${groupId}`;
                        tableElement.appendChild(badge);
                    }
                });
            });
        }

        // Auto-ungroup tables when they become empty
        function autoUngroupEmptyTables() {
            tableGroups.forEach((tableIds, groupId) => {
                const groupTables = Array.from(tableIds).map(id => tables.find(t => t.id === id));
                const hasOccupiedTables = groupTables.some(table => table && table.status !== 'available');
                
                if (!hasOccupiedTables) {
                    // All tables in group are available, ungroup them
                    groupTables.forEach(table => {
                        if (table) table.groupId = null;
                    });
                    tableGroups.delete(groupId);
                    console.log(`Auto-ungrouped empty group ${groupId}`);
                }
            });
            
            updateGroupedTablesDisplay();
            saveTableGroups();
        }

        // Comprehensive test function - can be called from browser console
        window.testFloorPlanComplete = function() {
            console.log('🚀 COMPREHENSIVE FLOOR PLAN TEST STARTING...');
            
            // Step 1: Clear existing data
            localStorage.removeItem('floorPlan');
            console.log('✅ Cleared existing floor plan data');
            
            // Step 2: Create sample data
            const sampleData = [
                {
                    id: 'table-1',
                    name: 'Test Table 1',
                    capacity: '4',
                    left: '100px',
                    top: '80px',
                    width: '80px',
                    height: '80px',
                    shapeType: 'circle',
                    rotationAngle: 0
                },
                {
                    id: 'table-2',
                    name: 'Test Table 2',
                    capacity: '6',
                    left: '250px',
                    top: '80px',
                    width: '120px',
                    height: '70px',
                    shapeType: 'rectangle',
                    rotationAngle: 0
                }
            ];
            
            localStorage.setItem('floorPlan', JSON.stringify(sampleData));
            console.log('✅ Created sample data:', sampleData);
            
            // Step 3: Test the condition check directly
            const savedPlan = localStorage.getItem('floorPlan');
            const parsedData = JSON.parse(savedPlan);
            const hasPositions = parsedData.some(table => table.left);
            console.log('✅ Direct condition check (parsedData.some(table => table.left)):', hasPositions);
            
            // Step 4: Reinitialize tables
            console.log('🔄 Reinitializing tables...');
            initializeTables();
            
            // Step 5: Check tables array
            console.log('✅ Tables array after initialization:', tables);
            console.log('✅ Tables with left property:', tables.filter(t => t.left));
            
            // Step 6: Test condition on tables array
            const tablesHavePositions = tables.some(table => table.left);
            console.log('✅ Tables array condition check (tables.some(table => table.left)):', tablesHavePositions);
            
            // Step 7: Manually call renderTables
            console.log('🎨 Manually calling renderTables...');
            renderTables();
            
            // Step 8: Check final DOM state
            const canvas = document.getElementById('floorPlanCanvas');
            console.log('✅ Final canvas state:', {
                exists: !!canvas,
                childrenCount: canvas ? canvas.children.length : 0,
                innerHTML: canvas ? canvas.innerHTML.substring(0, 200) + '...' : 'N/A'
            });
            
            // Step 9: Try direct injection as fallback
            console.log('🧪 Testing direct injection...');
            testDirectTableInjection();
            
            console.log('🎉 COMPREHENSIVE TEST COMPLETE');
            
            return {
                sampleDataCreated: true,
                hasPositions,
                tablesHavePositions,
                tablesCount: tables.length,
                canvasChildren: canvas ? canvas.children.length : 0
            };
        };
        window.debugFloorPlanDetailed = function() {
            console.log('=== COMPREHENSIVE FLOOR PLAN DEBUG ===');
            
            // 1. Check basic elements
            const floorPlanCanvas = document.getElementById('floorPlanCanvas');
            const tablesView = document.getElementById('tablesView');
            
            console.log('1. Basic Elements:');
            console.log('  - Floor plan canvas:', floorPlanCanvas ? 'EXISTS' : 'MISSING');
            console.log('  - Tables view:', tablesView ? 'EXISTS' : 'MISSING');
            console.log('  - Tables view display:', tablesView ? tablesView.style.display : 'N/A');
            
            if (floorPlanCanvas) {
                const canvasRect = floorPlanCanvas.getBoundingClientRect();
                console.log('  - Canvas position:', {
                    top: canvasRect.top,
                    left: canvasRect.left,
                    width: canvasRect.width,
                    height: canvasRect.height,
                    visible: canvasRect.width > 0 && canvasRect.height > 0
                });
                console.log('  - Canvas children count:', floorPlanCanvas.children.length);
            }
            
            // 2. Check tables data
            console.log('\n2. Tables Data:');
            console.log('  - Tables array length:', tables.length);
              if (tables.length > 0) {
                console.log('  - Sample table structure:', {
                    id: tables[0].id,
                    hasLeft: !!tables[0].left,
                    hasTop: !!tables[0].top,
                    left: tables[0].left,
                    top: tables[0].top,
                    width: tables[0].width,
                    height: tables[0].height,
                    // Legacy check
                    hasPosition: !!tables[0].position,
                    position: tables[0].position
                });
                  let hasPositionData = 0;
                tables.forEach(table => {
                    if (table.left) {
                        hasPositionData++;
                    }
                });
                console.log('  - Tables with position data (direct properties):', hasPositionData);
                
                // Also check what the actual condition we use returns
                const conditionResult = tables.some(table => table.left);
                console.log('  - Condition check (tables.some(table => table.left)):', conditionResult);
            }
            
            // 3. Check localStorage
            console.log('\n3. LocalStorage:');
            const savedPlan = localStorage.getItem('floorPlan');
            if (savedPlan) {
                try {
                    const parsedPlan = JSON.parse(savedPlan);
                    console.log('  - Floor plan data found:', parsedPlan.length, 'tables');
                    console.log('  - Sample floor plan item:', parsedPlan[0]);
                } catch (error) {
                    console.log('  - Error parsing floor plan data:', error.message);
                }
            } else {
                console.log('  - No floor plan data in localStorage');
            }
            
            // 4. Check rendered elements
            console.log('\n4. Rendered Elements:');
            if (floorPlanCanvas) {
                const renderedTables = floorPlanCanvas.querySelectorAll('.floor-plan-table');
                console.log('  - Rendered table elements:', renderedTables.length);
                
                renderedTables.forEach((table, index) => {
                    const rect = table.getBoundingClientRect();
                    const computedStyle = getComputedStyle(table);
                    console.log(`  - Table ${index + 1}:`, {
                        id: table.id,
                        className: table.className,
                        position: {
                            left: table.style.left,
                            top: table.style.top,
                            width: table.style.width,
                            height: table.style.height
                        },
                        computed: {
                            display: computedStyle.display,
                            visibility: computedStyle.visibility,
                            opacity: computedStyle.opacity,
                            zIndex: computedStyle.zIndex
                        },
                        boundingRect: {
                            top: rect.top,
                            left: rect.left,
                            width: rect.width,
                            height: rect.height,
                            visible: rect.width > 0 && rect.height > 0
                        }
                    });
                });
            }
            
            // 5. Test creation of a simple table
            console.log('\n5. Manual Table Creation Test:');
            if (floorPlanCanvas) {
                const testTable = document.createElement('div');
                testTable.className = 'floor-plan-table available circle';
                testTable.id = 'debug-test-table';
                testTable.style.left = '10px';
                testTable.style.top = '10px';
                testTable.style.width = '80px';
                testTable.style.height = '80px';
                testTable.style.background = 'red'; // Make it obvious
                testTable.style.zIndex = '9999';
                testTable.innerHTML = '<div>TEST</div>';
                
                floorPlanCanvas.appendChild(testTable);
                console.log('  - Test table created and added to canvas');
                
                // Remove it after 3 seconds
                setTimeout(() => {
                    if (testTable.parentNode) {
                        testTable.parentNode.removeChild(testTable);
                        console.log('  - Test table removed');
                    }
                }, 3000);
            }
              console.log('\n=== END DEBUG ===');
        };

        // Keyboard Shortcuts System
        let keyboardShortcutsActive = true;
        let shortcutHelpVisible = false;

        // Initialize keyboard shortcuts
        function initializeKeyboardShortcuts() {
            document.addEventListener('keydown', handleKeyboardShortcut);
            
            // Show keyboard shortcuts help on first load
            setTimeout(() => {
                showNotification('Press F1 or ? to view keyboard shortcuts', 'info');
            }, 2000);
        }

        function handleKeyboardShortcut(event) {
            // Don't trigger shortcuts when typing in inputs or textareas
            if (event.target.tagName === 'INPUT' || 
                event.target.tagName === 'TEXTAREA' || 
                event.target.tagName === 'SELECT' ||
                event.target.isContentEditable) {
                return;
            }

            // Don't trigger if modals are open (except for escape to close them)
            const modalsOpen = document.querySelectorAll('.modal-overlay.active').length > 0;
            if (modalsOpen && event.key !== 'Escape') {
                return;
            }

            const key = event.key.toLowerCase();
            const ctrl = event.ctrlKey || event.metaKey;
            const shift = event.shiftKey;
            const alt = event.altKey;

            // Prevent default for our shortcuts
            let preventDefault = true;

            switch (key) {
                // Tab Navigation
                case '1':
                    if (!ctrl) switchToTab('menu');
                    break;
                case '2':
                    if (!ctrl) switchToTab('tables');
                    break;
                case '3':
                    if (!ctrl) switchToTab('kitchen');
                    break;

                // Menu/Cart Actions
                case 'p':
                    if (ctrl) {
                        event.preventDefault();
                        processPayment();
                    } else if (currentView === 'menu' && cart.length > 0) {
                        processPayment();
                    }
                    break;
                case 'enter':
                    if (currentView === 'menu' && cart.length > 0) {
                        processPayment();
                    } else {
                        preventDefault = false;
                    }
                    break;
                case 'delete':
                case 'backspace':
                    if (currentView === 'menu' && cart.length > 0) {
                        clearCart();
                    } else {
                        preventDefault = false;
                    }
                    break;

                // Table Actions
                case 't':
                    if (currentView === 'menu') {
                        showTablesModal();
                    }
                    break;
                case 'r':
                    if (currentView === 'tables') {
                        refreshFloorPlan();
                    }
                    break;
                case 's':
                    if (currentView === 'tables') {
                        createSampleFloorPlanData();
                    }
                    break;

                // Quick Actions
                case 'escape':
                    // Close any open modals
                    closeAllModals();
                    // Clear table selection
                    if (selectedTable) {
                        clearTableSelection();
                    }
                    break;

                // Print Actions
                case 'f2':
                    if (currentView === 'menu' && cart.length > 0) {
                        printCheck();
                    }
                    break;

                // Help
                case 'f1':
                case '?':
                    if (shift || key === '?') {
                        showKeyboardShortcutsHelp();
                    } else if (key === 'f1') {
                        showKeyboardShortcutsHelp();
                    } else {
                        preventDefault = false;
                    }
                    break;

                // Edit Actions
                case 'e':
                    if (ctrl && selectedTable && cart.length > 0) {
                        editCheck();
                    } else {
                        preventDefault = false;
                    }
                    break;

                // Void Check
                case 'v':
                    if (ctrl && cart.length > 0) {
                        voidCheck();
                    } else {
                        preventDefault = false;
                    }
                    break;

                // Quick Numbers for menu items (if in menu view)
                case '4':
                case '5':
                case '6':
                case '7':
                case '8':
                case '9':
                case '0':
                    if (!ctrl && currentView === 'menu') {
                        quickSelectMenuItem(parseInt(key) || 10);
                    } else {
                        preventDefault = false;
                    }
                    break;

                default:
                    preventDefault = false;
                    break;
            }

            if (preventDefault) {
                event.preventDefault();
            }
        }

        // Helper function to switch tabs
        function switchToTab(view) {
            const tabButton = document.querySelector(`.tab-button[onclick="switchTab('${view}')"]`);
            if (tabButton) {
                tabButton.click();
                showNotification(`Switched to ${view} view`, 'info');
            }
        }

        // Close all modals function
        function closeAllModals() {
            const modals = document.querySelectorAll('.modal-overlay.active');
            modals.forEach(modal => {
                modal.classList.remove('active');
            });
            
            // Reset modal-specific variables
            currentReservationTableId = null;
            currentTagsTableId = null;
        }

        // Quick select menu item by position
        function quickSelectMenuItem(position) {
            const menuItems = document.querySelectorAll('.menu-item');
            if (menuItems[position - 1]) {
                menuItems[position - 1].click();
                showNotification(`Added item ${position} to cart`, 'success');
            }
        }

        // Show keyboard shortcuts help modal
        function showKeyboardShortcutsHelp() {
            if (shortcutHelpVisible) {
                hideKeyboardShortcutsHelp();
                return;
            }

            const helpModal = document.createElement('div');
            helpModal.className = 'modal-overlay active';
            helpModal.id = 'keyboardShortcutsModal';
            helpModal.innerHTML = `
                <div class="modal" style="max-width: 700px;">
                    <div class="modal-header">
                        <h3 class="modal-title">⌨️ Keyboard Shortcuts</h3>
                        <button class="modal-close" onclick="hideKeyboardShortcutsHelp()">×</button>
                    </div>
                    <div class="modal-content">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                            <div>
                                <h4 style="margin-bottom: 1rem; color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem;">Navigation</h4>
                                <div class="shortcut-list">
                                    <div class="shortcut-item"><kbd>1</kbd> Switch to Menu</div>
                                    <div class="shortcut-item"><kbd>2</kbd> Switch to Tables</div>
                                    <div class="shortcut-item"><kbd>3</kbd> Switch to Kitchen</div>
                                    <div class="shortcut-item"><kbd>Esc</kbd> Close Modals / Clear Selection</div>
                                </div>

                                <h4 style="margin: 1.5rem 0 1rem 0; color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem;">Menu & Cart</h4>
                                <div class="shortcut-list">
                                    <div class="shortcut-item"><kbd>Enter</kbd> Process Payment</div>
                                    <div class="shortcut-item"><kbd>Ctrl</kbd> + <kbd>P</kbd> Process Payment</div>
                                    <div class="shortcut-item"><kbd>Delete</kbd> Clear Cart</div>
                                    <div class="shortcut-item"><kbd>T</kbd> Select Table</div>
                                    <div class="shortcut-item"><kbd>4-9, 0</kbd> Quick Add Menu Items</div>
                                </div>
                            </div>

                            <div>
                                <h4 style="margin-bottom: 1rem; color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem;">Tables & Orders</h4>
                                <div class="shortcut-list">
                                    <div class="shortcut-item"><kbd>R</kbd> Refresh Floor Plan</div>
                                    <div class="shortcut-item"><kbd>S</kbd> Create Sample Data</div>
                                    <div class="shortcut-item"><kbd>F2</kbd> Print Check</div>
                                    <div class="shortcut-item"><kbd>Ctrl</kbd> + <kbd>E</kbd> Edit Check</div>
                                    <div class="shortcut-item"><kbd>Ctrl</kbd> + <kbd>V</kbd> Void Check</div>
                                </div>

                                <h4 style="margin: 1.5rem 0 1rem 0; color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem;">Help & Info</h4>
                                <div class="shortcut-list">
                                    <div class="shortcut-item"><kbd>F1</kbd> or <kbd>?</kbd> Show This Help</div>
                                    <div class="shortcut-item"><kbd>Esc</kbd> Close This Help</div>
                                </div>

                                <div style="margin-top: 1.5rem; padding: 1rem; background: #f3f4f6; border-radius: 8px; font-size: 0.9rem; color: #6b7280;">
                                    <strong>💡 Pro Tip:</strong> Shortcuts are disabled when typing in forms. Press <kbd>Esc</kbd> to quickly exit any modal or selection.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(helpModal);
            shortcutHelpVisible = true;

            // Close on overlay click
            helpModal.addEventListener('click', (e) => {
                if (e.target === helpModal) {
                    hideKeyboardShortcutsHelp();
                }
            });
        }

        function hideKeyboardShortcutsHelp() {
            const helpModal = document.getElementById('keyboardShortcutsModal');
            if (helpModal) {
                helpModal.remove();
                shortcutHelpVisible = false;
            }
        }

        // Add CSS for keyboard shortcuts help
        const shortcutStyles = document.createElement('style');
        shortcutStyles.textContent = `
            .shortcut-list {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }

            .shortcut-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.5rem 0;
                font-size: 0.9rem;
            }

            .shortcut-item kbd {
                background: #f3f4f6;
                border: 1px solid #d1d5db;
                border-radius: 4px;
                padding: 0.25rem 0.5rem;
                font-family: 'Courier New', monospace;
                font-size: 0.8rem;
                font-weight: 600;
                color: #374151;
                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
                margin: 0 0.25rem;
            }

            .shortcut-item kbd:first-child {
                margin-left: 0;
            }

            .shortcut-item kbd:last-child {
                margin-right: 0;
            }

            /* Visual indicator for active shortcuts */
            .shortcut-indicator {
                position: fixed;
                bottom: 10px;
                left: 10px;
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 0.5rem;
                border-radius: 4px;
                font-size: 0.8rem;
                z-index: 9999;
                opacity: 0;
                transition: opacity 0.3s ease;
            }

            .shortcut-indicator.visible {
                opacity: 1;
            }
        `;        document.head.appendChild(shortcutStyles);        // Load super admin functionality if available
        if (typeof SuperAdminManager === 'undefined') {
            const script = document.createElement('script');
            script.src = 'super-admin.js';
            document.head.appendChild(script);
        }

        // Hotel Mode Integration - Check if hotel mode should be activated
        function checkHotelModeActivation() {
            if (typeof HotelMode !== 'undefined' && HotelMode.isHotelModeActive()) {
                console.log('🏨 Hotel Mode detected - activating hotel features');
                
                // Show Room Service tab
                const roomServiceTab = document.getElementById('roomServiceTab');
                if (roomServiceTab) {
                    roomServiceTab.style.display = 'inline-block';
                }
                
                // Apply hotel styling
                HotelMode.applyHotelStyling();
                
                // Initialize room service menu
                setTimeout(() => {
                    if (HotelMode.initializeRoomServiceMenu) {
                        HotelMode.initializeRoomServiceMenu();
                    }
                }, 1000);
                
                console.log('✅ Hotel Mode features activated');
            } else {
                console.log('🏢 Running in restaurant mode');
            }
        }

        // Initialize hotel mode checking after DOM is loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(checkHotelModeActivation, 500);
            });
        } else {
            setTimeout(checkHotelModeActivation, 500);
        }

        // Hotel Mode Toggle Function - can be called from business settings
        function toggleHotelMode(activate = true) {
            if (typeof HotelMode === 'undefined') {
                console.warn('HotelMode class not available');
                return false;
            }
            
            const roomServiceTab = document.getElementById('roomServiceTab');
            
            if (activate) {
                // Activate Hotel Mode
                HotelMode.activateHotelMode();
                if (roomServiceTab) {
                    roomServiceTab.style.display = 'inline-block';
                }
                HotelMode.applyHotelStyling();
                showNotification('🏨 Hotel Mode activated', 'success');
                console.log('Hotel Mode activated');
            } else {
                // Deactivate Hotel Mode
                HotelMode.deactivateHotelMode();
                if (roomServiceTab) {
                    roomServiceTab.style.display = 'none';
                }
                // Switch away from room service tab if currently active
                if (currentView === 'roomservice') {
                    switchTab('menu');
                }
                showNotification('🏢 Restaurant Mode activated', 'info');
                console.log('Hotel Mode deactivated');
            }
              return true;
        }

        // Print Order Modal Functions
        function openPrintOrderModal() {
            const guestName = document.getElementById('guestName').value.trim();
            const roomNumber = document.getElementById('roomNumber').value.trim();
            const loyaltyStatus = document.getElementById('loyaltyStatus');
            const loyaltyStatusText = loyaltyStatus.options[loyaltyStatus.selectedIndex]?.text || 'None';
            
            if (!guestName || !roomNumber || roomServiceCart.length === 0) {
                showNotification('Please fill in required fields and add items to cart', 'warning');
                return;
            }
            
            // Calculate totals
            const subtotal = roomServiceCart.reduce((sum, item) => sum + (parseFloat(item.price || 0) * item.quantity), 0);
            const tax = subtotal * roomServiceTaxRate;
            const serviceCharge = subtotal * roomServiceServiceCharge;
            const total = subtotal + tax + serviceCharge;
            
            // Create modal HTML
            const modalOverlay = document.createElement('div');
            modalOverlay.className = 'modal-overlay';
            modalOverlay.id = 'printOrderModal';
            modalOverlay.classList.add('active');
            
            const currentTime = new Date().toLocaleString();
            const orderId = `RS_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            
            const modalContent = `
                <div class="print-modal">
                    <div class="print-modal-header">
                        <h2 class="print-modal-title"><span>🖨️</span> Print Order Details</h2>
                        <button class="modal-close" onclick="closePrintModal()">&times;</button>
                    </div>
                    <div class="print-modal-content">
                        <div class="guest-info-section">
                            <h2 style="font-size: 24px; margin-bottom: 15px;">Guest Information</h2>
                            <table style="width: 100%; border-collapse: collapse; font-size: 18px;">
                                <tr>
                                    <td style="padding: 8px 0; font-weight: bold; width: 150px;">Guest Name:</td>
                                    <td style="padding: 8px 0; font-size: 22px;">${guestName}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px 0; font-weight: bold;">Room Number:</td>
                                    <td style="padding: 8px 0; font-size: 22px;">${roomNumber}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px 0; font-weight: bold;">Loyalty Status:</td>
                                    <td style="padding: 8px 0;">
                                        ${loyaltyStatusText !== 'None' ? 
                                            `<span class="print-loyalty-badge">${loyaltyStatusText}</span>` : 
                                            'None'}
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px 0; font-weight: bold;">Order Time:</td>
                                    <td style="padding: 8px 0;">${currentTime}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px 0; font-weight: bold;">Order ID:</td>
                                    <td style="padding: 8px 0;">${orderId}</td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="order-items-section">
                            <h2 style="font-size: 24px; margin-bottom: 15px;">Order Items</h2>
                            <table style="width: 100%; border-collapse: collapse; font-size: 18px;">
                                <thead>
                                    <tr style="background: #f3f4f6; text-align: left;">
                                        <th style="padding: 10px; border-bottom: 1px solid #e5e7eb;">Item</th>
                                        <th style="padding: 10px; border-bottom: 1px solid #e5e7eb; text-align: center;">Qty</th>
                                        <th style="padding: 10px; border-bottom: 1px solid #e5e7eb; text-align: right;">Price</th>
                                        <th style="padding: 10px; border-bottom: 1px solid #e5e7eb; text-align: right;">Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${roomServiceCart.map(item => `
                                        <tr>
                                            <td style="padding: 12px 10px; border-bottom: 1px solid #e5e7eb;">
                                                <div style="font-size: 20px;">${item.name}</div>
                                                ${item.description ? `<div style="color: #6b7280; font-size: 16px;">${item.description}</div>` : ''}
                                            </td>
                                            <td style="padding: 12px 10px; border-bottom: 1px solid #e5e7eb; text-align: center; font-size: 20px;">${item.quantity}</td>
                                            <td style="padding: 12px 10px; border-bottom: 1px solid #e5e7eb; text-align: right; font-size: 20px;">$${parseFloat(item.price || 0).toFixed(2)}</td>
                                            <td style="padding: 12px 10px; border-bottom: 1px solid #e5e7eb; text-align: right; font-size: 20px; font-weight: 600;">$${(parseFloat(item.price || 0) * item.quantity).toFixed(2)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>

                        <div class="order-totals">
                            <table style="width: 100%; border-collapse: collapse; font-size: 18px;">
                                <tr>
                                    <td style="padding: 8px 0; text-align: right;">Subtotal:</td>
                                    <td style="padding: 8px 0; text-align: right; width: 150px;">$${subtotal.toFixed(2)}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px 0; text-align: right;">Service Charge (${(roomServiceServiceCharge * 100).toFixed(0)}%):</td>
                                    <td style="padding: 8px 0; text-align: right;">$${serviceCharge.toFixed(2)}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px 0; text-align: right;">Tax (${(roomServiceTaxRate * 100).toFixed(1)}%):</td>
                                    <td style="padding: 8px 0; text-align: right;">$${tax.toFixed(2)}</td>
                                </tr>
                                <tr style="font-weight: bold; font-size: 22px;">
                                    <td style="padding: 12px 0; text-align: right; border-top: 2px solid #000;">Total:</td>
                                    <td style="padding: 12px 0; text-align: right; border-top: 2px solid #000;">$${total.toFixed(2)}</td>
                                </tr>
                            </table>
                        </div>

                        ${document.getElementById('specialInstructions').value.trim() ? `
                        <div class="special-instructions-section" style="margin-top: 20px;">
                            <h3 style="font-size: 20px; margin-bottom: 10px;">Special Instructions</h3>
                            <div style="padding: 12px; background: #fffbeb; border: 1px solid #fbbf24; border-radius: 6px; font-size: 18px;">
                                ${document.getElementById('specialInstructions').value.trim()}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                    <div class="print-modal-footer">
                        <button class="print-btn" onclick="closePrintModal()">Cancel</button>
                        <button class="print-btn" onclick="printOrderDetails()">
                            <span style="display: flex; align-items: center; gap: 5px;"><span>🖨️</span> Print Order</span>
                        </button>
                    </div>
                </div>
            `;
            
            modalOverlay.innerHTML = modalContent;
            document.body.appendChild(modalOverlay);
        }

        function closePrintModal() {
            const modal = document.getElementById('printOrderModal');
            if (modal) {
                document.body.removeChild(modal);
            }
        }

        function printOrderDetails() {
            window.print();
        }

        // Function to update room service button states
        function updateRoomServiceButtonStates() {
            const checkoutBtn = document.getElementById('roomServiceCheckoutBtn');
            const printBtn = document.getElementById('roomServicePrintBtn');
            const guestName = document.getElementById('guestName')?.value.trim();
            const roomNumber = document.getElementById('roomNumber')?.value.trim();
            
            if (checkoutBtn && printBtn) {
                const hasRequiredFields = guestName && roomNumber && roomServiceCart.length > 0;
                checkoutBtn.disabled = !hasRequiredFields;
                printBtn.disabled = !hasRequiredFields;
            }
        }

        // Modify the updateRoomServiceCartDisplay function to also update button states
        const originalUpdateRoomServiceCartDisplay = updateRoomServiceCartDisplay;
        updateRoomServiceCartDisplay = function() {
            originalUpdateRoomServiceCartDisplay.apply(this, arguments);
            updateRoomServiceButtonStates();
        };

        // Add event listeners for input fields
        document.addEventListener('DOMContentLoaded', function() {
            const guestNameInput = document.getElementById('guestName');
            const roomNumberInput = document.getElementById('roomNumber');
            
            if (guestNameInput) {
                guestNameInput.addEventListener('input', updateRoomServiceButtonStates);
            }
            
            if (roomNumberInput) {
                roomNumberInput.addEventListener('input', updateRoomServiceButtonStates);
            }
        });
    </script>
</body>
</html>
